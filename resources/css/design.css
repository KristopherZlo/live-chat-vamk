:root {
  --bg: #ebebeb;
  --bg-elevated: #ffffff;
  --bg-soft: #f9f9f9;
  --border-subtle: #e7e7e7;
  --border-strong: #dbdbdb;
  --text-primary: #0d0d0d;
  --text-secondary: #5d5d5d;
  --accent: #2563eb;
  --accent-soft: #dbeafe;
  --accent-strong: #1d4ed8;
  --danger: #dc2626;
  --muted: #9ca3af;
  --message-in: #ffffff;
  --message-out: #eef0f4;
  --scroll-track: #e6e9ef;
  --scroll-thumb: #c8ccd6;
  --notify: #f97316;
  --ok: #16a34a;
  --bad: #dc2626;
  --app-viewport-height: 100vh;
  --panel-header-padding: 0.75rem;
  --list-rhythm: 0.75rem;
  --btn-border-neutral: color-mix(in srgb, var(--border-subtle) 80%, var(--bg-elevated) 20%);
  --focus-outline: 2px solid var(--accent);
  --radius-sm: 0.55rem;
  --radius-md: 0.7rem;
  --radius-lg: 0.85rem;
  --radius-xl: 1rem;
  --radius-pill: 999px;

  /* === UNIVERSAL TRANSPARENT PALETTE === */
  --surface-alpha: 0.16;
  --surface-hover-alpha: 0.28;
  --border-alpha: 0.7;
  --border-hover-alpha: 1;
  --text-on-accent-light: rgba(255,255,255,0.9);
  --text-on-accent-dark: rgba(0,0,0,0.85);
  --blue-accent:#7289da;
  --blue-bg:rgba(15,20,35,0.75);
  --blue-bg-hover:rgba(22,32,70,0.9);
  --blue-border:rgba(114,137,218,0.9);
  --blue-border-hover:rgba(114,137,218,1);
  --blue-text:rgba(255,255,255,0.95);
  --green-accent:#67c960;
  --green-bg:rgba(10,24,10,0.75);
  --green-bg-hover:rgba(30,70,30,0.9);
  --green-border:rgba(103,201,96,0.9);
  --green-border-hover:rgba(103,201,96,1);
  --green-text:rgba(255,255,255,0.95);
  --cyan-accent:#2e9fd2;
  --cyan-bg:rgba(10,24,30,0.75);
  --cyan-bg-hover:rgba(20,70,90,0.9);
  --cyan-border:rgba(46,159,210,0.9);
  --cyan-border-hover:rgba(46,159,210,1);
  --cyan-text:rgba(255,255,255,0.95);
  --orange-accent:#da8b72;
  --orange-bg:rgba(30,18,10,0.75);
  --orange-bg-hover:rgba(95,55,30,0.9);
  --orange-border:rgba(218,139,114,0.9);
  --orange-border-hover:rgba(218,139,114,1);
  --orange-text:rgba(255,255,255,0.95);
  --red-accent:#da7272;
  --red-bg:rgba(30,10,10,0.75);
  --red-bg-hover:rgba(95,35,35,0.9);
  --red-border:rgba(218,114,114,0.9);
  --red-border-hover:rgba(218,114,114,1);
  --red-text:rgba(255,255,255,0.95);
  --purple-accent:#9a72da;
  --purple-bg:rgba(24,14,33,0.75);
  --purple-bg-hover:rgba(60,35,95,0.9);
  --purple-border:rgba(154,114,218,0.9);
  --purple-border-hover:rgba(154,114,218,1);
  --purple-text:rgba(255,255,255,0.95);
  --pink-accent:#da72a1;
  --pink-bg:rgba(30,10,22,0.75);
  --pink-bg-hover:rgba(95,35,70,0.9);
  --pink-border:rgba(218,114,161,0.9);
  --pink-border-hover:rgba(218,114,161,1);
  --pink-text:rgba(255,255,255,0.95);
  --gray-accent:#727272;
  --gray-bg:rgba(20,20,20,0.75);
  --gray-bg-hover:rgba(40,40,40,0.9);
  --gray-border:rgba(114,114,114,0.9);
  --gray-border-hover:rgba(114,114,114,1);
  --gray-text:rgba(255,255,255,0.9);
}

@supports (height: 100dvh){

  :root {
    --app-viewport-height: 100dvh;
  }

}

[data-theme="dark"] {
  --bg: #141414;              /* нейтральный тёмно-серый */
  --bg-elevated: #1c1c1c;
  --bg-soft: #262626;
  --panel-header: #202020;

  --border-subtle: #2e2e2e;
  --border-strong: #383838;

  --text-primary: #f2f2f2;
  --text-secondary: #a8a8a8;

  --accent: #2563eb;
  --accent-soft: rgba(37, 99, 235, 0.18);
  --accent-strong: #1d4ed8;

  --danger: #ef4444;
  --muted: #8a8a8a;

  --message-in: #242424;
  --message-out: #2a2a2a;

  --scroll-track: #1a1a1a;
  --scroll-thumb: #3d3d3d;

  --notify: #2563eb;
  --ok: #4ade80;
  --bad: #f87171;
  --btn-blue-bg: #1b1d25;
  --btn-blue-border: #7289da;
  --btn-blue-hover: #2b365f;
  --btn-green-bg: #1a2319;
  --btn-green-border: #67c960;
  --btn-green-hover: #345732;
  --btn-cyan-bg: #141f24;
  --btn-cyan-border: #2e9fd2;
  --btn-cyan-hover: #1b5d70;
  --btn-orange-bg: #251c1b;
  --btn-orange-border: #da8b72;
  --btn-orange-hover: #5f3d2b;
  --btn-red-bg: #241b1b;
  --btn-red-border: #da7272;
  --btn-red-hover: #5f2b2b;
  --btn-purple-bg: #211b25;
  --btn-purple-border: #9a72da;
  --btn-purple-hover: #3d2b5f;
  --btn-pink-bg: #251b21;
  --btn-pink-border: #da72a1;
  --btn-pink-hover: #5f2b46;
  --btn-gray-bg: #1f1f1f;
  --btn-gray-border: #727272;
  --btn-gray-hover: #2b2b2b;
}

* {
  box-sizing: border-box;
  scrollbar-width: thin;
  scrollbar-color: var(--scroll-thumb) transparent;
}

body {
  margin: 0;
  font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  background: var(--bg);
  color: var(--text-primary);
}

body,html {
  min-height: 100%;
}

.app {
  min-height: 100vh;
  display: flex;
  flex-direction: column;
}

.app-header {
  padding: 0.75rem 1.25rem;
  justify-content: space-between;
  border-bottom: 1px solid var(--border-subtle);
  background: var(--bg-elevated);
  gap: 0.75rem;
  position: sticky;
  top: 0;
  z-index: 50;
  margin: 0;
}

.app-header,.app-title {
  display: flex;
  align-items: center;
}

.app-title {
  font-weight: 600;
  font-size: 1rem;
  gap: 0.65rem;
}

.app-title-text {
  display: flex;
  flex-direction: column;
  gap: 0.15rem;
}

.app-subtitle {
  font-size: 0.75rem;
  color: var(--text-secondary);
}

.app-logo {
  width: 2.8rem;
  display: flex;
  align-items: center;
  justify-content: center;
}

.app-logo-link {
  display: block;
  line-height: 0;
}

.app-logo-img {
  height: 2rem;
  width: auto;
  display: block;
}

.app-logo-img--dark {
  display: none;
}

[data-theme="dark"] .app-logo-img--dark {
  display: block;
}

[data-theme="dark"] .app-logo-img--light {
  display: none;
}

.app-title span.badge {
  font-size: 0.75rem;
  padding: 0.1rem 0.4rem;
  border-radius: 999px;
  border: 1px solid rgba(107, 139, 255, 0.5);
  background: rgba(107, 139, 255, 0.12);
  color: #6b8bff;
  font-weight: 600;
}

.app-controls {
  gap: 0.75rem;
  font-size: 0.85rem;
}

.app-controls,.app-nav {
  display: flex;
  align-items: center;
}

.app-nav {
  gap: 0.5rem;
  flex-wrap: wrap;
}

.app-nav-primary,
.app-nav-room-actions {
  display: flex;
  align-items: center;
  gap: 0.4rem;
}

.app-nav-room-actions {
  flex-wrap: wrap;
}

.app-nav-room-actions:empty {
  display: none;
}

#qrButton i {
  font-size: 0.85rem;
}

.room-info {
  display: flex;
  flex-direction: column;
  gap: 0.1rem;
  text-align: right;
}

.room-name {
  font-weight: 500;
}

.room-code {
  color: var(--text-secondary);
  padding: 0.2rem 0.65rem;
  border-radius: var(--radius-pill);
  background: var(--bg-soft);
}

.room-code,.btn,
.icon-btn {
  display: inline-flex;
  align-items: center;
  gap: 0.35rem;
  font-size: 0.8rem;
  border: 1px solid var(--btn-border-neutral);
}

.btn,
.icon-btn {
  background: transparent;
  color: var(--text-primary);
  padding: 0.4rem 0.7rem;
  border-radius: var(--radius-pill);
  cursor: pointer;
}

.btn,
.icon-btn,
.btn-primary,
.btn-danger,
.btn-ghost,
.send-btn,
.mobile-tab-btn,
.mobile-menu-row .btn,
.mobile-menu-row .icon-btn {
  box-shadow: none !important;
}

.btn-primary {
  border-color: var(--accent);
  background: var(--accent);
  color: #f9fafb;
}

.btn-ghost,.btn-danger {
  background: transparent;
}

.btn-danger {
  border-color: var(--danger);
  color: var(--danger);
}

.btn-sm {
  padding: 0.25rem 0.6rem;
  font-size: 0.75rem;
}

.btn-sm,.btn-group {
  border-radius: var(--radius-pill);
}

.btn-group {
  display: inline-flex;
  border: 1px solid var(--border-subtle);
  overflow: hidden;
}

.btn-group button {
  border: none;
  border-right: 1px solid var(--border-subtle);
  background: transparent;
  color: var(--text-secondary);
  padding: 0.3rem 0.7rem;
  font-size: 0.78rem;
  cursor: pointer;
}

.btn-group button:last-child {
  border-right: none;
}

.btn-group button.active {
  background: var(--accent);
  color: #f9fafb;
}

.icon-btn {
  width: 2.2rem;
  height: 2.2rem;
  justify-content: center;
  border-radius: 999px;
  transition: background-color 0.15s ease-out,
                  border-color 0.15s ease-out,
                  color 0.15s ease-out;
}

.icon-btn svg {
  width: 1.2rem;
  height: 1.2rem;
}

.icon-btn svg[data-lucide="x"] {
  width: 1.5rem;
  height: 1.5rem;
}

.icon-btn .lucide-x,
.modal-close .lucide-x {
  width: 1.5rem;
  height: 1.5rem;
}

.mobile-menu-btn,.mobile-menu-overlay {
  display: none;
}

main {
  flex: 1 1 auto;
  display: flex;
  flex-direction: column;
  padding: 0.75rem 1.25rem 1rem;
  width: 100%;
}

main,.layout {
  gap: 0.75rem;
  min-height: 600px;
}

.layout {
  display: grid;
  grid-template-columns: 2fr 1.2fr;
  height: calc(var(--app-viewport-height, 100vh) - 200px);
  max-height: none;
  flex: 1 1 auto;
  grid-auto-rows: minmax(0, 1fr);
}

.layout.teacher {
  grid-template-columns: 1.65fr 1.35fr !important;
  grid-template-rows: 1fr !important;
  align-items: stretch;
}

.mobile-tabs {
  display: none;
}

.panel {
  border: 1px solid var(--border-subtle);
  border-radius: var(--radius-lg);
  background: var(--bg-elevated);
  display: flex;
  flex-direction: column;
  overflow: hidden;
  min-height: 0;
  height: auto;
}

.panel.chat-panel,
.panel.queue-panel,
.panel.student-panel {
  min-height: 420px;
}

.panel-header {
  padding: var(--panel-header-padding);
  border-bottom: 1px solid var(--border-subtle);
  justify-content: space-between;
  font-size: 0.8rem;
}

.panel-header,.panel-title {
  display: flex;
  align-items: center;
}

.panel-title {
  font-weight: 500;
  gap: 0.4rem;
  margin-bottom: 10px;
}

.panel-title svg {
  width: 1rem;
  height: 1rem;
}

.panel-subtitle {
  color: var(--text-secondary);
  font-size: 0.75rem;
  margin-bottom: 5px;
}

.text-ok {
  color: var(--ok);
  font-weight: 600;
}

.text-bad {
  color: var(--bad);
  font-weight: 600;
}

.panel-body {
  flex: 1;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

.panel-footer {
  padding: 0.5rem 0.75rem;
  border-top: 1px solid var(--border-subtle);
  font-size: 0.75rem;
  color: var(--text-secondary);
  display: flex;
  justify-content: space-between;
  gap: 0.5rem;
  align-items: center;
}

.chat-messages {
  list-style: none;
  margin: 0;
  padding: 0.75rem;
  flex: 1;
  min-height: 0;
  overflow-y: auto;
  overflow-x: visible;
  scroll-behavior: smooth;
  position: relative;
}

.chat-messages::-webkit-scrollbar {
  width: 6px;
}

.chat-messages::-webkit-scrollbar-track {
  background: transparent;
  border-radius: 999px;
}

.chat-messages::-webkit-scrollbar-thumb {
  background: var(--scroll-thumb);
  border-radius: 999px;
}

.message {
  margin-bottom: 0.5rem;
  display: flex;
  align-items: flex-start;
  gap: 0.4rem;
  opacity: 0;
  transform: translateY(6px);
  animation: message-in 0.15s ease-out forwards;
  overflow: visible;
}

.message--outgoing {
  justify-content: flex-end;
}

.message-avatar {
  width: 1.7rem;
  height: 1.7rem;
  border-radius: 999px;
  border: 1px solid var(--border-subtle);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.7rem;
  color: var(--text-secondary);
  flex-shrink: 0;
  position: relative;
  z-index: 2;
}

.message-avatar.colorized {
  color: #fff;
  font-weight: 700;
  border-color: transparent;
}

.message-body {
  max-width: 70%;
  padding: 0.4rem 0.55rem;
  border-radius: var(--radius-md);
  border: 1px solid var(--border-subtle);
  background: var(--message-in);
  font-size: 0.8rem;
  display: flex;
  flex-direction: column;
  gap: 0.18rem;
  position: relative;
  overflow: visible;
  z-index: 1;
}

.message--outgoing .message-body {
  background: var(--message-out);
  border-color: transparent;
}

.message--question .message-body {
  border-color: var(--accent);
  box-shadow: 0 0 0 1px var(--accent-soft);
}

.message-header {
  display: flex;
  justify-content: space-between;
  align-items: baseline;
  gap: 0.5rem;
}

.message-author {
  font-weight: 500;
  font-size: 0.78rem;
  display: inline-flex;
}

.message-author,.message-meta {
  align-items: center;
  gap: 0.35rem;
}

.message-meta {
  font-size: 0.7rem;
  color: var(--text-secondary);
  display: flex;
}

.message-reply {
  border-left: 2px solid var(--accent);
  padding-left: 0.45rem;
  margin: 0.1rem 0;
  font-size: 0.78rem;
  color: var(--text-secondary);
  cursor: pointer;
  transition: background 0.18s ease;
  border-radius: 0 var(--radius-sm) var(--radius-sm) 0;
}

.message-reply:hover {
  background: color-mix(in srgb, var(--accent-soft) 40%, transparent);
}

.message-reply[data-reply-deleted="1"] .reply-text {
  font-style: italic;
  color: var(--text-secondary);
}

.message-reply .reply-author {
  font-weight: 600;
  color: var(--text-primary);
  margin-right: 0.35rem;
}

.message--flash {
  position: relative;
}

.message--flash::after {
  content: "";
  position: absolute;
  inset: -6px -10px;
  border-radius: var(--radius-xl);
  background: color-mix(in srgb, var(--accent-soft) 75%, transparent);
  animation: messageRowFlash 1.4s ease-out forwards;
  pointer-events: none;
  z-index: 0;
}

.message--flash .message-body {
  position: relative;
  z-index: 1;
  animation: none;
  box-shadow: none;
}

@keyframes messageRowFlash {
  0% {
    background: color-mix(in srgb, var(--accent) 30%, var(--accent-soft));
    opacity: 1;
  }
  60% {
    background: color-mix(in srgb, var(--accent) 15%, var(--accent-soft));
    opacity: 0.8;
  }
  100% {
    background: transparent;
    opacity: 0;
  }
}

.message-text {
  font-size: 0.8rem;
  line-height: 1.3;
  color: var(--text-primary);
  white-space: pre-wrap;
  overflow-wrap: anywhere;
  word-break: break-word;
}

.message--poll .message-body {
  max-width: calc(100% - 2.2rem);
  width: calc(100% - 2.2rem);
}

.message--poll .message-text {
  display: none;
}

.message-poll {
  display: flex;
  flex-direction: column;
  gap: 0.45rem;
  margin-top: 0.1rem;
}

.poll-question {
  font-weight: 600;
  font-size: 0.82rem;
  color: var(--text-primary);
  overflow-wrap: anywhere;
  word-break: break-word;
}

.poll-options {
  display: flex;
  flex-direction: column;
  gap: 0.35rem;
}

.poll-option {
  position: relative;
  border: 1px solid var(--border-subtle);
  background: color-mix(in srgb, var(--bg-elevated) 90%, var(--accent-soft));
  border-radius: var(--radius-lg);
  padding: 0.4rem 0.55rem;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 0.4rem;
  cursor: pointer;
  overflow: hidden;
  transition: border-color 0.2s ease, color 0.2s ease, background 0.2s ease;
}

.poll-option[disabled] {
  cursor: not-allowed;
  opacity: 0.65;
}

.poll-option.is-selected {
  border-color: var(--accent);
  color: var(--accent-strong);
  background: color-mix(in srgb, var(--accent-soft) 45%, var(--bg-elevated));
}

.poll-option-bar {
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  width: 0;
  background: color-mix(in srgb, var(--accent) 18%, transparent);
  transform-origin: left center;
  z-index: 0;
  pointer-events: none;
}

.poll-option-label,
.poll-option-stats {
  position: relative;
  z-index: 1;
}

.poll-option-label {
  font-size: 0.78rem;
  color: var(--text-primary);
  overflow-wrap: anywhere;
  word-break: break-word;
}

.poll-option-stats {
  display: inline-flex;
  gap: 0.3rem;
  font-size: 0.7rem;
  color: var(--text-secondary);
}

.poll-footer {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 0.5rem;
  font-size: 0.7rem;
  color: var(--text-secondary);
}

.poll-status {
  color: var(--accent-strong);
  font-weight: 500;
}

.message.poll-loading .poll-option,
.message.poll-loading .poll-option[disabled] {
  opacity: 0.5;
  pointer-events: none;
}

.message-badge {
  font-size: 0.7rem;
  padding: 0.05rem 0.3rem;
  border-radius: 999px;
  border: 1px solid var(--border-subtle);
  color: var(--text-secondary);
}

.message-badge-dev {
  border-color: var(--accent);
  color: var(--accent-strong);
  background: var(--accent-soft);
}

.message-badge-teacher {
  background: var(--accent);
  border-color: var(--accent);
  color: #f9fafb;
}

.message-badge-question {
  border-color: var(--accent);
  color: var(--accent-strong);
  background: var(--accent-soft);
}

.message-actions {
  margin-top: 0.15rem;
  display: flex;
  justify-content: flex-end;
  gap: 0.25rem;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.1s ease-out;
  font-size: 0.75rem;
}

.message:hover .message-actions {
  opacity: 1;
  pointer-events: auto;
}

.msg-action {
  border: none;
  background: transparent;
  border-radius: 999px;
  padding: 0.1rem 0.35rem;
  font-size: 0.7rem;
  display: inline-flex;
  align-items: center;
  gap: 0.2rem;
  cursor: pointer;
  color: var(--text-secondary);
}

.msg-action svg {
  width: 0.9rem;
  height: 0.9rem;
  pointer-events: none;
}

.msg-action-danger {
  color: var(--bad);
}

.msg-action-form {
  display: inline-flex;
}

.msg-action-react {
  color: var(--text-secondary);
}

.message:not(.has-reactions) .message-reactions {
  display: none;
}

.message-reactions {
  display: flex;
  flex-wrap: wrap;
  gap: 0.3rem;
  margin-top: 0.15rem;
}

.reactions-list {
  display: inline-flex;
  flex-wrap: wrap;
  gap: 0.25rem;
}

.reaction-chip {
  border: 1px solid var(--border-subtle);
  background: var(--bg-elevated);
  border-radius: 999px;
  padding: 0.15rem 0.45rem;
  display: inline-flex;
  align-items: center;
  gap: 0.3rem;
  cursor: pointer;
  font-size: 0.78rem;
  color: var(--text-secondary);
  transition: transform 0.12s ease-out, border-color 0.12s ease-out, box-shadow 0.12s ease-out, background-color 0.12s ease-out;
}

.reaction-chip .emoji {
  font-size: 1rem;
}

.reaction-chip .count {
  font-weight: 700;
  color: var(--text-primary);
}

.reaction-chip:hover {
  transform: translateY(-1px);
  border-color: var(--accent);
  color: var(--text-primary);
}

.reaction-chip.is-active {
  border-color: var(--accent);
  background: var(--accent-soft);
  color: var(--accent-strong);
  box-shadow: inset 0 0 0 1px var(--accent-soft);
}

.reactions-list:empty::after {
  content: attr(data-empty-text);
}

.reaction-menu {
  position: fixed;
  left: 0;
  top: 0;
  min-width: 200px;
  max-width: min(360px, 92vw);
  max-height: calc(100vh - 24px);
  overflow: auto;
  background: color-mix(in srgb, var(--bg-elevated) 94%, transparent);
  border: 1px solid color-mix(in srgb, var(--border-subtle) 70%, transparent);
  border-radius: var(--radius-lg);
  padding: 0.5rem 0.55rem 0.45rem;
  box-shadow: 0 14px 30px rgba(15, 23, 42, 0.16);
  backdrop-filter: blur(10px);
  z-index: 50;
  overscroll-behavior: contain;
}

.reaction-menu[hidden] {
  display: none;
}

.reaction-menu-title {
  margin-bottom: 0.15rem;
  letter-spacing: 0.01em;
}

.reaction-menu-title,.reaction-menu-current {
  font-size: 0.78rem;
  color: var(--text-secondary);
}

.reaction-menu-current {
  display: inline-flex;
  align-items: center;
  gap: 0.35rem;
  padding: 0.3rem 0.4rem;
  border-radius: var(--radius-sm);
  background: color-mix(in srgb, var(--bg-soft) 80%, transparent);
  margin-bottom: 0.35rem;
}

.reaction-menu-current .label {
  text-transform: uppercase;
  letter-spacing: 0.04em;
  font-size: 0.68rem;
  color: var(--text-tertiary);
}

.reaction-menu-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(38px, 1fr));
  gap: 0.2rem;
  justify-items: center;
}

.reaction-menu-btn {
  border: none;
  background: transparent;
  border-radius: 0.75rem;
  width: 38px;
  height: 38px;
  font-size: 1.25rem;
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  color: var(--text-primary);
  transition: transform 0.12s ease-out, background-color 0.12s ease-out, box-shadow 0.12s ease-out;
}

.reaction-menu-btn:hover {
  background: color-mix(in srgb, var(--accent-soft) 70%, transparent);
  transform: translateY(-1px);
}

.reaction-menu-btn.is-active {
  background: var(--accent-soft);
  transform: translateY(-1px);
}

.reaction-menu-more {
  font-size: 1.05rem;
  grid-column: 1 / -1;
  width: 100%;
  justify-content: center;
  background: color-mix(in srgb, var(--bg-soft) 85%, transparent);
}

.reaction-menu-more-panel {
  margin-top: 0.35rem;
  border-radius: 0.75rem;
  overflow: hidden;
  border: 1px solid var(--border-subtle);
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.05);
}

.reaction-menu-more-panel[hidden] {
  display: none;
}

.reaction-menu-more-panel emoji-picker {
  width: 100%;
  --background: var(--bg-elevated);
  --border-color: transparent;
  --button-hover-background: color-mix(in srgb, var(--bg-soft) 80%, transparent);
  --focus-indicator: var(--accent);
  max-height: 240px;
}

.message.reactions-loading .reaction-chip,
.message.reactions-loading [data-reaction-trigger],
.message.reactions-loading [data-reaction-option] {
  opacity: 0.55;
  pointer-events: none;
}

.message-admin-actions {
  position: absolute;
  top: 0.3rem;
  right: calc(-1.85rem - 5px);
  opacity: 0.15;
  transform: translateX(22px);
  transition: opacity 0.12s ease-out, transform 0.18s ease-out;
  display: flex;
  flex-direction: column;
  gap: 0.35rem;
}

.message:hover .message-admin-actions {
  opacity: 1;
  transform: translateX(0);
}

.message-ban-form,
.message-delete-form {
  margin: 0;
}

.message-ban-btn,
.message-delete-btn {
  border: 1px solid var(--border-subtle);
  background: var(--bg-soft);
  border-radius: var(--radius-sm);
  padding: 0.2rem;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  color: var(--text-secondary);
  width: 28px;
  height: 28px;
}

.message-ban-btn:hover,
.message-delete-btn:hover {
  color: var(--bad);
  border-color: var(--bad);
}

@keyframes message-in{

      to {
        opacity: 1;
        transform: translateY(0);
      }
    
}

.chat-input {
  border-top: 1px solid var(--border-subtle);
  padding: 0.55rem 0.7rem;
  display: flex;
  flex-direction: column;
  flex-shrink: 0;
  gap: 0.45rem;
  background: var(--bg-elevated);
  border-radius: 0 0 1rem 1rem;
  box-shadow: 0 -8px 18px rgba(15, 23, 42, 0.08);
  max-height: 50vh;
  overflow-y: auto;
  overflow-x: hidden;
  scrollbar-gutter: stable;
}

.chat-send-options {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 0.65rem;
  flex-wrap: wrap;
}

.ban-notice {
  color: var(--bad);
  font-weight: 600;
}

.chat-subtabs {
  display: flex;
  padding: 0.35rem 0.75rem 0.1rem;
  flex-wrap: wrap;
}

.chat-subtabs,.chat-tab-btn {
  gap: 0.35rem;
  align-items: center;
}

.chat-tab-btn {
  border: 1px solid transparent;
  background: transparent;
  color: var(--text-secondary);
  border-radius: var(--radius-pill);
  padding: 0.35rem 0.8rem;
  display: inline-flex;
  cursor: pointer;
  transition: all 0.14s ease-out;
}

.chat-tab-btn:hover {
  border-color: color-mix(in srgb, var(--accent) 65%, var(--border-subtle));
  background: color-mix(in srgb, var(--accent-soft) 55%, var(--bg-elevated));
  color: var(--accent-strong);
}

.chat-tab-btn [data-replies-unread]:not([hidden]) {
  background: var(--accent);
  color: #fff;
  border-color: var(--accent);
}

.chat-tab-btn.active {
  background: var(--bg-soft);
  color: var(--text-primary);
  border-color: var(--border-strong);
  box-shadow: inset 0 0 0 1px var(--border-subtle);
}

.chat-pane {
  display: flex;
  flex-direction: column;
  gap: 0.35rem;
  flex: 1;
  min-height: 0;
}

.chat-pane[hidden] {
  display: none;
}

.moderation-block {
  border: 1px solid var(--border-subtle);
  border-radius: 0.85rem;
  padding: 0.7rem 0.8rem;
  margin: 0.4rem 0.75rem 0.5rem;
  background: var(--bg-soft);
}

.moderation-head {
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  gap: 0.75rem;
}

.moderation-title {
  font-weight: 700;
  margin-bottom: 0.05rem;
}

.pill-soft {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 0.15rem 0.65rem;
  border-radius: 999px;
  background: var(--bg-soft);
  border: 1px solid var(--border-subtle);
  font-size: 0.8rem;
  color: var(--text-secondary);
}

.ban-list {
  list-style: none;
  margin: 0.65rem 0 0;
  padding: 0;
  display: flex;
  flex-direction: column;
  gap: 0.55rem;
}

.ban-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 0.75rem;
  padding: 0.5rem 0.6rem;
  border-radius: var(--radius-lg);
  border: 1px dashed var(--border-subtle);
}

.ban-name {
  font-weight: 700;
}

.ban-meta {
  font-size: 0.78rem;
  color: var(--text-secondary);
}

.question-actions-secondary {
  display: flex;
  align-items: center;
  flex-wrap: wrap;
  gap: 0.35rem;
  margin-top: 0.35rem;
}

.chat-input-row {
  display: grid;
  grid-template-columns: 1fr auto;
  gap: 0.45rem;
  align-items: stretch;
}

.reply-preview {
  position: relative;
  display: grid;
  grid-template-columns: auto 1fr auto;
  column-gap: 0.55rem;
  row-gap: 0.3rem;
  align-items: center;
  border: 1px solid var(--border-strong);
  border-left: 3px solid var(--accent);
  background: var(--bg-elevated);
  border-radius: var(--radius-md);
  padding: 0.6rem 0.7rem;
  box-shadow: none;
  min-width: 0;
  margin: 0.4rem 0;
}

.reply-preview-label {
  display: inline-flex;
  grid-column: 1 / 2;
  gap: 0.35rem;
  align-items: center;
  font-size: 0.8rem;
  color: var(--text-secondary);
  font-weight: 700;
}

.reply-preview-label i {
  color: var(--accent);
}

.reply-preview-text {
  grid-column: 1 / 4;
  min-width: 0;
  font-size: 0.83rem;
  color: var(--text-primary);
  line-height: 1.4;
  word-break: break-word;
}

.reply-preview-author {
  color: var(--text-primary);
  font-weight: 700;
}

.reply-preview .icon-btn {
  grid-row: 1 / 2;
  grid-column: 3 / 4;
  width: 2rem;
  height: 2rem;
  min-width: 2rem;
  border-color: var(--border-subtle);
  color: var(--text-secondary);
}

.reply-preview .icon-btn,.chat-textarea {
  background: transparent;
  box-shadow: none;
}

  .chat-textarea {
    width: 100%;
    border: none;
    padding: 0.55rem 0.35rem;
    padding-right: 2.4rem;
    padding-bottom: 1.2rem;
    font-size: clamp(16px, 1rem, 18px);
    resize: none;
    min-height: 2.8rem;
    max-height: 10rem;
    color: var(--text-primary);
    outline: none;
    caret-color: var(--text-primary);
    line-height: 1.4;
    font-family: inherit;
  }

.chat-textarea::placeholder {
  color: var(--muted);
}

.chat-textarea:focus {
  outline: none;
  box-shadow: none;
  border-color: var(--border-subtle);
}

@media (max-width: 640px) {
  .chat-textarea {
    font-size: 15px;
    line-height: 1.4;
    padding: 0.45rem 0.35rem;
    padding-right: 2.2rem;
    padding-bottom: 1.1rem;
  }

  .panel.chat-panel,
  .panel.queue-panel,
  .panel.student-panel {
    min-height: 320px;
  }

  .chat-input {
    max-height: 50vh;
  }

  .poll-composer {
    padding: 0.5rem;
  }

  .poll-composer-header {
    flex-direction: column;
    align-items: flex-start;
  }

  .poll-composer-actions {
    flex-wrap: wrap;
  }

  .poll-option-input {
    flex-direction: column;
    align-items: stretch;
  }

  .poll-option-remove {
    align-self: flex-end;
  }

  .emoji-picker-element {
    max-height: 210px;
  }
}

.chat-composer {
  display: grid;
  grid-template-columns: auto 1fr auto;
  align-items: flex-end;
  gap: 0.4rem;
  padding: 0.4rem 0.5rem;
  background: var(--bg-elevated);
  border: 1px solid var(--border-subtle);
  border-radius: 1.1rem;
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.4);
}

.composer-btn {
  border: none;
  background: transparent;
  width: 2.8rem;
  height: 2.8rem;
  border-radius: 0.9rem;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  color: var(--text-secondary);
  transition: background-color 0.12s ease-out, color 0.12s ease-out, transform 0.12s ease-out, opacity 0.12s ease-out;
}

.composer-btn.is-active {
  color: var(--accent);
}

.composer-btn svg {
  width: 1.1rem;
  height: 1.1rem;
  pointer-events: none;
}

  .composer-btn:hover {
    background: var(--bg-soft);
    color: var(--text-primary);
  }

  .composer-btn:disabled {
    cursor: default;
    opacity: 0.6;
  }

  .quick-responses {
    display: flex;
    align-items: flex-start;
    gap: 0.45rem;
    width: 100%;
    background: transparent;
    border: none;
    padding: 0;
  }

  .quick-responses__buttons {
    flex: 1;
    display: flex;
    flex-wrap: nowrap;
    align-items: flex-start;
    justify-content: flex-start;
    gap: 0.45rem;
    min-width: 0;
    overflow: hidden;
  }

  .quick-responses__button {
    cursor: pointer;
    width: auto;
    max-width: 100%;
    flex: 0 1 auto;
    min-width: 0;
    border-radius: var(--radius-xl);
    padding: 0.55rem 0.65rem;
    font-size: 0.9rem;
    line-height: 1.4;
    color: var(--text-primary);
    background: var(--bg-elevated);
    border: 1px solid var(--border-strong);
    position: relative;
  overflow: hidden;
  display: flex;
  justify-content: flex-start;
  align-items: center;
  text-align: left;
  gap: 0.25rem;
    box-shadow: none;
  transition: color 0.2s ease, border-color 0.2s ease, background 0.2s ease;
  white-space: nowrap;
  text-overflow: ellipsis;
  }

  .quick-responses__button strong {
    font-weight: 500;
  }

  .quick-responses__button::after {
    content: '';
    position: absolute;
    right: 0;
    top: 0;
    bottom: 0;
    width: 30px;
    pointer-events: none;
    background: linear-gradient(to left, color-mix(in srgb, var(--bg-elevated) 90%, rgba(255, 255, 255, 0)), transparent);
  }

  .quick-responses__button:hover,
  .quick-responses__button:focus {
    border-color: var(--accent);
    color: var(--accent);
    background: color-mix(in srgb, var(--accent-soft) 32%, var(--bg-elevated) 68%);
  }

.quick-responses__button:focus-visible {
    outline: var(--focus-outline);
    outline-offset: 2px;
  }
  .quick-responses__settings,
  .quick-responses__poll {
    border: none;
    background: color-mix(in srgb, var(--bg-soft) 85%, transparent);
    border-radius: 999px;
    width: 38px;
    height: 38px;
    display: grid;
    place-items: center;
    color: var(--text-secondary);
    position: relative;
    cursor: pointer;
    box-shadow: none;
    transition: background 0.2s, box-shadow 0.2s, transform 0.2s;
    flex-shrink: 0;
  }

  .quick-responses__settings:hover,
  .quick-responses__settings:focus,
  .quick-responses__poll:hover,
  .quick-responses__poll:focus {
    background: color-mix(in srgb, var(--accent-soft) 75%, transparent);
    box-shadow: none;
    color: var(--accent);
  }

  .quick-responses__settings:focus-visible,
  .quick-responses__poll:focus-visible {
    outline: var(--focus-outline);
    outline-offset: 2px;
  }
  .quick-responses__poll.is-active {
    background: color-mix(in srgb, var(--bg-soft) 85%, transparent);
    color: var(--text-secondary);
  }

  .poll-composer {
    margin: 0.45rem 0 0.6rem;
    padding: 0.6rem;
    border-radius: var(--radius-lg);
    border: 1px solid var(--border-subtle);
    background: color-mix(in srgb, var(--bg-elevated) 85%, var(--accent-soft));
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .poll-composer-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 0.4rem;
  }

  .poll-composer-title {
    font-weight: 600;
    font-size: 0.85rem;
    color: var(--text-primary);
  }

  .poll-composer-label {
    font-size: 0.7rem;
    color: var(--text-secondary);
  }

  .poll-composer-input {
    width: 100%;
    border-radius: var(--radius-md);
    border: 1px solid var(--border-strong);
    padding: 0.5rem 0.6rem;
    font-size: 0.8rem;
    background: var(--bg-elevated);
    color: var(--text-primary);
  }

  .input-counter {
    font-size: 0.65rem;
    color: var(--text-secondary);
    text-align: right;
    margin-top: 0.2rem;
  }

  .input-counter.is-hidden {
    display: none;
  }

  .input-counter.is-limit {
    color: var(--danger);
    font-weight: 600;
  }

  .chat-input-wrap {
    position: relative;
    flex: 1;
    display: flex;
    align-items: stretch;
    min-width: 0;
    width: 100%;
  }

  .chat-input-wrap .input-counter--chat {
    position: absolute;
    right: 0.6rem;
    bottom: 0.35rem;
    margin: 0;
    pointer-events: none;
  }

  .poll-composer-options {
    display: flex;
    flex-direction: column;
    gap: 0.35rem;
  }

  .poll-option-input {
    display: flex;
    align-items: flex-start;
    gap: 0.35rem;
  }

  .poll-option-field-wrap {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 0.2rem;
    min-width: 0;
  }

  .poll-option-field {
    flex: 0 0 auto;
    width: 100%;
    border-radius: var(--radius-md);
    border: 1px solid var(--border-subtle);
    padding: 0.45rem 0.55rem;
    font-size: 0.78rem;
    background: var(--bg-elevated);
    color: var(--text-primary);
  }

  .poll-option-remove {
    width: 2.2rem;
    height: 2.2rem;
    border-radius: 999px;
    margin-top: 0.1rem;
  }

  .poll-composer-actions {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

.chat-composer.is-poll-mode {
  display: flex;
  justify-content: flex-end;
  align-items: center;
  gap: 0.4rem;
  padding: 0;
  border: none;
  background: transparent;
  box-shadow: none;
  width: auto;
  align-self: flex-end;
}

.chat-composer.is-poll-mode .composer-emoji,
.chat-composer.is-poll-mode .chat-textarea,
.chat-composer.is-poll-mode .chat-input-wrap {
  display: none;
}

.chat-composer.is-poll-mode .composer-send {
  margin-left: auto;
  width: 2.8rem;
  height: 2.8rem;
  flex: 0 0 2.8rem;
}

  .quick-responses-modal {
    position: fixed;
    inset: 0;
    background: rgba(15, 23, 42, 0.65);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 200;
    color: var(--text-primary);
  }

  .quick-responses-modal.show {
    display: flex;
  }

  .quick-responses-modal .modal-card {
    background: var(--bg-elevated);
    border-radius: 1rem;
    padding: 1.25rem;
    width: min(420px, calc(100% - 2rem));
    box-shadow: 0 24px 36px rgba(15, 23, 42, 0.25);
    position: relative;
    border: 1px solid var(--border-strong);
  }

  .quick-responses-modal h3 {
    margin-top: 0;
    margin-bottom: 0.5rem;
  }

  .quick-responses-modal p {
    color: var(--text-secondary);
  }

  .quick-responses-modal .quick-responses-input {
    width: 100%;
    padding: 0.55rem 0.75rem;
    border-radius: 0.75rem;
    border: 1px solid var(--border-subtle);
    font-size: 0.9rem;
    font-family: inherit;
    background: var(--bg-soft);
    color: var(--text-primary);
  }

  .quick-responses-modal-list {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
    margin: 1rem 0 0.5rem;
  }

  .quick-response-row {
    display: grid;
    grid-template-columns: 1fr auto;
    gap: 0.5rem;
    align-items: end;
  }

  .quick-response-row .input-field {
    margin: 0;
  }

  .quick-response-remove {
    border: 1px solid var(--border-subtle);
    background: color-mix(in srgb, var(--bg-soft) 85%, transparent);
    color: var(--text-secondary);
    border-radius: 0.9rem;
    height: 100%;
    min-height: 2.75rem;
    width: 2.75rem;
    display: grid;
    place-items: center;
    cursor: pointer;
    transition: background 0.2s, color 0.2s, border-color 0.2s;
  }

  .quick-response-remove:hover,
  .quick-response-remove:focus-visible {
    background: color-mix(in srgb, var(--danger) 15%, transparent);
    border-color: color-mix(in srgb, var(--danger) 75%, transparent);
    color: var(--danger);
    outline: none;
  }

  .quick-responses-modal-actions {
    display: flex;
    justify-content: flex-start;
    margin-top: 0.5rem;
    margin-bottom: 0.25rem;
  }

  .quick-responses-modal .modal-actions {
    display: flex;
    justify-content: flex-end;
    gap: 0.6rem;
    margin-top: 0.45rem;
  }

  .quick-responses-modal .modal-close {
    position: absolute;
    top: 0.45rem;
    right: 0.45rem;
    background: transparent;
    border: none;
    color: var(--text-secondary);
    cursor: pointer;
    width: 32px;
    height: 32px;
    display: grid;
    place-items: center;
  }

  body[data-theme="dark"] .quick-responses__button {
    --quick-responses-inner-shadow: rgba(0, 0, 0, 0.55);
    background: color-mix(in srgb, var(--bg-soft) 80%, transparent);
    border-color: rgba(255, 255, 255, 0.15);
  }

  body[data-theme="dark"] .quick-responses__button:hover,
  body[data-theme="dark"] .quick-responses__button:focus {
    border-color: var(--accent);
    color: var(--accent);
  }

  body:not([data-theme="dark"]) .quick-responses__button {
    --quick-responses-inner-shadow: rgba(255, 255, 255, 0.65);
  }

  body[data-theme="dark"] .quick-responses__button::after {
    background: linear-gradient(to left, color-mix(in srgb, var(--bg-soft) 90%, rgba(0, 0, 0, 0)), transparent);
  }

  body[data-theme="dark"] .quick-responses-modal .modal-card {
    background: var(--bg-soft);
  }

  body[data-theme="dark"] .quick-responses-modal .quick-responses-input {
    background: color-mix(in srgb, var(--bg-soft) 90%, transparent);
    border-color: var(--border-strong);
  }

.composer-send {
  background: transparent;
  color: var(--text-secondary);
  border: none;
  box-shadow: none;
}

.composer-send.can-send {
  color: var(--accent);
}

.composer-send.can-send:hover {
  transform: translateY(-1px);
  background: var(--accent-soft);
}

.composer-send svg {
  transform: translateX(-1px);
}

.emoji-picker-panel {
  margin-top: 0.45rem;
  border: 1px solid var(--border-subtle);
  background: var(--bg-elevated);
  border-radius: 1rem;
  overflow: hidden;
  box-shadow: 0 18px 32px rgba(15, 23, 42, 0.16);
  color-scheme: light;
}

.emoji-picker-panel[hidden] {
  display: none;
}

.emoji-picker-element {
  width: 100%;
  max-height: 320px;
  border: none;
}

[data-theme="dark"] .emoji-picker-panel {
  background: var(--bg-elevated);
  border-color: var(--border-strong);
  color-scheme: dark;
}

[data-theme="dark"] .emoji-picker-element {
  --background-color: var(--bg-elevated);
  --text-color: var(--text-primary);
  --secondary-text-color: var(--text-secondary);
  --border-color: var(--border-strong);
  --input-background-color: var(--bg-soft);
  --input-border-color: var(--border-strong);
  --input-border-focus-color: var(--accent);
  --hover-color: var(--bg-soft);
}

.send-btn {
  border-radius: 0.75rem;
  border: 1px solid var(--accent);
  background: var(--accent);
  color: #f9fafb;
  width: 3rem;
  height: 3rem;
  min-width: 3rem;
  min-height: 3rem;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 0.35rem;
  cursor: pointer;
  font-size: 0.85rem;
  white-space: nowrap;
}

.send-btn .send-label {
  display: inline-block;
}

.send-btn svg {
  width: 1.1rem;
  height: 1.1rem;
  transition: transform 0.15s ease-out;
}

.send-btn.sending svg {
  transform: translateX(4px);
}

.chat-input-meta {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 0.5rem;
  font-size: 0.75rem;
}

.switch {
  display: inline-flex;
  align-items: center;
  gap: 0.3rem;
  cursor: pointer;
  font-size: 0.78rem;
}

#sendToTeacherSwitch {
  padding: 0.4rem 0.55rem;
  border: none;
  border-radius: 0.7rem;
  background: var(--bg-elevated);
}

.switch input {
  display: none;
}

.switch-track {
  width: 2.4rem;
  height: 1.4rem;
  border-radius: 999px;
  border: none;
  background: var(--bg-soft);
  position: relative;
  padding: 0 0.15rem;
  display: flex;
  align-items: center;
  box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.08);
}

.switch-thumb {
  width: 1rem;
  height: 1rem;
  border-radius: 999px;
  background: var(--muted);
  position: absolute;
  left: 0.15rem;
  transition: transform 0.18s ease-out, background 0.18s, box-shadow 0.18s;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.18);
}

.switch input:checked + .switch-track {
  background: var(--accent-soft);
}

.switch input:checked + .switch-track .switch-thumb {
  transform: translateX(1rem);
  background: var(--accent);
}

.switch-label {
  color: var(--text-secondary);
}

.role-student-only {
  display: none;
}

.role-student .role-student-only {
  display: inline-flex;
}

.role-teacher-only {
  display: none;
}

.role-teacher .role-teacher-only {
  display: inline-flex;
}

.questions-list,
    .queue-list {
  list-style: none;
  margin: 0;
  padding: var(--list-rhythm);
  flex: 1;
  overflow-y: auto;
  font-size: 0.8rem;
}

.questions-list::-webkit-scrollbar,
    .queue-list::-webkit-scrollbar {
  width: 6px;
}

.questions-list::-webkit-scrollbar-thumb,
    .queue-list::-webkit-scrollbar-thumb {
  background: var(--scroll-thumb);
  border-radius: 999px;
}

.queue-pagination {
  display: flex;
  justify-content: center;
  padding: 0.4rem 0.75rem 0.7rem;
}

.queue-loading {
  display: flex;
  align-items: center;
  justify-content: center;
  min-height: 2.5rem;
  width: 100%;
}

.queue-loading[hidden] {
  display: none;
}

.loader-5 {
  position: relative;
  height: 32px;
  width: 32px;
  animation: loader-5-1 2s cubic-bezier(0.77, 0, 0.175, 1) infinite;
}

@keyframes loader-5-1 {
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
}

.loader-5::before,
.loader-5::after,
.loader-5 span::before,
.loader-5 span::after {
  content: "";
  display: block;
  position: absolute;
  margin: auto;
  width: 8px;
  height: 8px;
  background: var(--accent, #2563eb);
  border-radius: 50%;
}

.loader-5::before {
  top: 0;
  left: 0;
  bottom: 0;
  right: auto;
  animation: loader-5-2 2s cubic-bezier(0.77, 0, 0.175, 1) infinite;
}

.loader-5::after {
  top: 0;
  left: auto;
  bottom: 0;
  right: 0;
  animation: loader-5-3 2s cubic-bezier(0.77, 0, 0.175, 1) infinite;
}

.loader-5 span {
  display: block;
  position: absolute;
  top: 0;
  left: 0;
  bottom: 0;
  right: 0;
  margin: auto;
  height: 32px;
  width: 32px;
}

.loader-5 span::before {
  top: 0;
  left: 0;
  bottom: auto;
  right: 0;
  animation: loader-5-4 2s cubic-bezier(0.77, 0, 0.175, 1) infinite;
}

.loader-5 span::after {
  top: auto;
  left: 0;
  bottom: 0;
  right: 0;
  animation: loader-5-5 2s cubic-bezier(0.77, 0, 0.175, 1) infinite;
}

@keyframes loader-5-2 {
  0% {
    transform: translate3d(0, 0, 0) scale(1);
  }
  50% {
    transform: translate3d(24px, 0, 0) scale(0.5);
  }
  100% {
    transform: translate3d(0, 0, 0) scale(1);
  }
}

@keyframes loader-5-3 {
  0% {
    transform: translate3d(0, 0, 0) scale(1);
  }
  50% {
    transform: translate3d(-24px, 0, 0) scale(0.5);
  }
  100% {
    transform: translate3d(0, 0, 0) scale(1);
  }
}

@keyframes loader-5-4 {
  0% {
    transform: translate3d(0, 0, 0) scale(1);
  }
  50% {
    transform: translate3d(0, 24px, 0) scale(0.5);
  }
  100% {
    transform: translate3d(0, 0, 0) scale(1);
  }
}

@keyframes loader-5-5 {
  0% {
    transform: translate3d(0, 0, 0) scale(1);
  }
  50% {
    transform: translate3d(0, -24px, 0) scale(0.5);
  }
  100% {
    transform: translate3d(0, 0, 0) scale(1);
  }
}

.question-item,
    .queue-item {
  border-radius: var(--radius-md);
  border: 1px solid var(--border-subtle);
  padding: var(--list-rhythm);
  margin-bottom: 0.5rem;
  display: flex;
  flex-direction: column;
  gap: 0.35rem;
  background: var(--bg-soft);
}

.queue-item {
  cursor: default;
  transition: transform 0.15s ease-out, border-color 0.15s ease-out;
}

.queue-item.queue-item-new {
  cursor: pointer;
  animation: queue-pulse 1.2s ease-in-out infinite;
  border-color: var(--notify);
  box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.2);
  background: color-mix(in srgb, var(--accent-soft) 70%, var(--bg-elevated) 30%);
}

[data-theme="dark"] .queue-item.queue-item-new {
  border-color: var(--accent);
  box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.35);
  background: rgba(37, 99, 235, 0.14);
}

.queue-item.queue-item-new:hover {
  transform: translateY(-1px);
}

@keyframes queue-pulse{

  0% {
    transform: translateY(0);
    border-color: var(--border-subtle);
  }
  50% {
    transform: translateY(-2px);
    border-color: var(--accent);
  }
      100% {
        transform: translateY(0);
        border-color: var(--border-subtle);
      }
    
}

.question-header {
  justify-content: space-between;
  gap: 0.4rem;
  font-size: 0.75rem;
}

.question-header,.question-meta {
  display: flex;
  align-items: center;
}

.question-meta {
  gap: 0.3rem;
  color: var(--text-secondary);
}

.status-pill {
  border-radius: 999px;
  font-size: 0.7rem;
  padding: 0.05rem 0.4rem;
  border: 1px solid var(--border-subtle);
}

.status-new {
  border-color: var(--accent);
  color: var(--accent-strong);
}

.status-later {
  border-color: #f97316;
  color: #ea580c;
}

.status-answered {
  border-color: #16a34a;
  color: #15803d;
}

.status-ignored {
  border-color: #6b7280;
  color: #6b7280;
}

.status-hidden {
  border-color: #64748b;
  color: #64748b;
}

[data-theme="dark"] .status-new {
  border-color: var(--accent);
  color: #e5edff;
  background: rgba(37, 99, 235, 0.15);
  font-weight: 700;
}

[data-theme="dark"] .status-later {
  border-color: #f97316;
  color: #ea580c;
}

[data-theme="dark"] .status-answered {
  border-color: #16a34a;
  color: #15803d;
}

.question-text {
  font-size: 0.8rem;
  line-height: 1.3;
}

.question-actions {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 0.35rem;
  margin-top: 0.15rem;
  flex-wrap: wrap;
}

.rating {
  display: inline-flex;
  gap: 0.3rem;
  align-items: center;
  font-size: 0.75rem;
}

.rating-label {
  color: var(--text-secondary);
}

.rating-options {
  display: inline-flex;
  gap: 0.25rem;
}

.rating-pill {
  border-radius: 999px;
  border: 1px solid var(--border-subtle);
  background: var(--bg-elevated);
  padding: 0.1rem 0.5rem;
  font-size: 0.72rem;
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  gap: 0.2rem;
  color: var(--text-secondary);
}

.rating-pill-ok {
  border-color: var(--ok);
  color: var(--ok);
}

.rating-pill-bad {
  border-color: var(--bad);
  color: var(--bad);
}

.rating-pill.active {
  background: var(--accent-soft);
  border-color: var(--accent);
  color: var(--accent-strong);
}

.rating-disabled {
  opacity: 0.4;
  pointer-events: none;
}

.queue-controls {
  display: flex;
  flex-wrap: wrap;
  gap: 0.25rem;
  justify-content: flex-end;
}

.queue-action {
  gap: 0.25rem;
  cursor: pointer;
  transition: background-color 0.15s ease-out,
                  border-color 0.15s ease-out,
                  color 0.15s ease-out;
}

.queue-action,.queue-count-badge {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  border-radius: 999px;
  border: 1px solid var(--border-subtle);
  padding: 0.12rem 0.55rem;
  font-size: 0.72rem;
  color: var(--text-secondary);
}

.queue-count-badge {
  background: var(--bg-soft);
}

.queue-ban-btn,.queue-delete-btn {
  display: inline-flex;
  align-items: center;
  gap: 0.35rem;
  border-color: var(--border-subtle);
  background: var(--bg-soft);
  color: var(--text-secondary);
  border-radius: 999px;
  transition: background-color 0.15s ease-out,
              border-color 0.15s ease-out,
              color 0.15s ease-out;
}

.btn.queue-ban-btn,
.btn.queue-delete-btn {
  color: var(--text-secondary);
}

.queue-action-answered {
  border-color: var(--ok);
  color: var(--ok);
}

.queue-action-later {
  border-color: var(--notify);
  color: var(--notify);
}

.queue-action-ignored {
  border-color: #6b7280;
  color: #6b7280;
}

.queue-action-hide {
  border-color: #64748b;
  color: #64748b;
}

.queue-item[data-status]:not([data-status="new"]) .queue-action-answered,
.queue-item[data-status]:not([data-status="new"]) .queue-action-ignored,
.queue-item[data-status]:not([data-status="new"]) .queue-action-later {
  background: var(--bg-soft);
  border-color: var(--border-subtle);
  color: var(--text-secondary);
}

.queue-item[data-status]:not([data-status="new"]) .queue-action-answered:hover,
.queue-item[data-status]:not([data-status="new"]) .queue-action-answered:focus-visible {
  background: color-mix(in srgb, var(--ok) 10%, var(--bg-elevated) 90%);
  border-color: var(--ok);
  color: var(--ok);
}

.queue-item[data-status]:not([data-status="new"]) .queue-action-ignored:hover,
.queue-item[data-status]:not([data-status="new"]) .queue-action-ignored:focus-visible {
  background: color-mix(in srgb, #6b7280 10%, var(--bg-elevated) 90%);
  border-color: #6b7280;
  color: #6b7280;
}

.queue-item[data-status]:not([data-status="new"]) .queue-action-later:hover,
.queue-item[data-status]:not([data-status="new"]) .queue-action-later:focus-visible {
  background: color-mix(in srgb, var(--notify) 10%, var(--bg-elevated) 90%);
  border-color: var(--notify);
  color: var(--notify);
}

[data-theme="dark"] .queue-action-answered {
  border-color: #16a34a;
  color: #16a34a;
}

[data-theme="dark"] .queue-action-later {
  border-color: #f97316;
  color: #f97316;
}

[data-theme="dark"] .queue-action-ignored {
  border-color: #6b7280;
  color: #6b7280;
}

.queue-meta {
  font-size: 0.75rem;
  color: var(--text-secondary);
  display: flex;
  gap: 0.35rem;
  align-items: center;
  justify-content: space-between;
  margin-top: 0.2rem;
  flex-wrap: wrap;
}

.queue-info,.order-toggle {
  font-size: 0.72rem;
}

.order-toggle {
  display: inline-flex;
  border-radius: 999px;
  border: 1px solid var(--border-subtle);
  overflow: hidden;
}

.order-toggle button {
  border: none;
  background: transparent;
  padding: 0.12rem 0.6rem;
  cursor: pointer;
  color: var(--text-secondary);
}

.order-toggle button.active {
  background: var(--bg-soft);
  color: var(--text-primary);
}

.queue-header-extra {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  justify-content: flex-end;
  font-size: 0.75rem;
  flex-wrap: wrap;
}

.queue-filter {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  position: relative;
  padding: 0.25rem 0.55rem;
  border: 1px solid var(--border-subtle);
  border-radius: var(--radius-md);
  background: var(--bg-soft);
}

.queue-filter-label {
  display: inline-flex;
  align-items: center;
  font-size: 0.78rem;
  color: color-mix(in srgb, var(--text-primary) 65%, var(--text-secondary));
  font-weight: 600;
  padding-right: 0.65rem;
  margin-right: 0.4rem;
  border-right: 1px solid color-mix(in srgb, var(--border-subtle) 75%, transparent);
}

.queue-filter-select {
  border: 1px solid color-mix(in srgb, var(--border-subtle) 70%, transparent);
  border-radius: 0.65rem;
  background: color-mix(in srgb, var(--bg-elevated) 92%, transparent);
  color: var(--text-primary);
  padding: 0.45rem 2.4rem 0.45rem 0.75rem;
  font-size: 0.84rem;
  min-width: 160px;
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
  transition: border-color 0.12s ease-out, background-color 0.12s ease-out;
}

.queue-filter-select:focus-visible {
  outline: var(--focus-outline);
  outline-offset: 2px;
  border-color: var(--accent);
  box-shadow: none;
}

.queue-filter::after {
  content: "";
  position: absolute;
  right: 14px;
  top: 50%;
  width: 0.55rem;
  height: 0.55rem;
  border-left: 2px solid var(--text-secondary);
  border-bottom: 2px solid var(--text-secondary);
  transform: translateY(-50%) rotate(-45deg);
  pointer-events: none;
}

.queue-filter-select:hover {
  border-color: var(--border-strong);
  background: var(--bg-soft);
}

.queue-list.queue-list-filter-empty {
  display: none;
}

.queue-pip-btn {
  display: inline-flex;
  align-items: center;
  gap: 0;
}

.queue-pip-btn.active {
  color: var(--notify);
}

.queue-pip-body {
  margin: 0;
  padding: 0.75rem;
  background: var(--bg-primary);
  min-height: 100vh;
  box-sizing: border-box;
}

.queue-pip-shell {
  height: calc(100vh - 1.5rem);
  display: flex;
  flex-direction: column;
}

.queue-pip-shell #queuePanel {
  flex: 1;
  display: flex;
  flex-direction: column;
}

.queue-pip-shell .panel {
  margin: 0;
  display: flex;
  flex-direction: column;
  height: 100%;
}

  .queue-pip-shell .panel-body,.queue-pip-shell .queue-list {
    flex: 1;
    overflow: auto;
  }

  .queue-pip-fallback {
    margin: 0 0 0.35rem;
    color: var(--text-secondary);
    font-size: 0.8rem;
  }

  .queue-pip-body #queuePanel {
    width: 100vw;
    max-width: 100vw;
    border-radius: 0;
  }

  .queue-pip-body #queuePanel .panel {
    width: 100%;
  }

.queue-new-badge {
  gap: 0.2rem;
  padding: 0.05rem 0.45rem;
  border-radius: 999px;
  background: var(--notify);
  color: #f9fafb;
  display: inline-flex;
  align-items: center;
  font-size: 0.72rem;
}

.question-feedback {
  display: inline-flex;
  align-items: center;
  gap: 0.3rem;
  margin-top: 0.28rem;
  font-size: 0.75rem;
  color: var(--muted);
}

.question-feedback__label {
  font-weight: 600;
  color: var(--text-secondary);
}

.feedback-pill {
  display: inline-flex;
  align-items: center;
  gap: 0.25rem;
  border-radius: var(--radius-pill);
  padding: 0.14rem 0.5rem;
  border: 1px solid color-mix(in srgb, var(--border-subtle) 80%, var(--bg-elevated) 20%);
  font-size: 0.72rem;
  font-weight: 600;
  background: color-mix(in srgb, var(--bg-elevated) 94%, transparent);
}

.feedback-pill-ok {
  color: var(--ok);
  border-color: color-mix(in srgb, var(--ok) 40%, var(--border-subtle) 60%);
  background: color-mix(in srgb, var(--ok) 8%, var(--bg-soft) 92%);
}

.feedback-pill-bad {
  color: var(--bad);
  border-color: color-mix(in srgb, var(--bad) 40%, var(--border-subtle) 60%);
  background: color-mix(in srgb, var(--bad) 7%, var(--bg-soft) 93%);
}

.queue-panel.notify {
  border-color: var(--notify);
}

.rating-pill-neutral {
  background: var(--bg-soft);
  color: var(--text-secondary);
}

.queue-panel.has-new {
  border-color: var(--notify);
  box-shadow: 0 0 0 2px rgba(249, 115, 22, 0.28);
}

[data-theme="dark"] .queue-panel.has-new {
  border-color: var(--notify);
  box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.35);
}

.qr-overlay {
  position: fixed;
  inset: 0;
  background: rgba(15, 23, 42, 0.6);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 40;
}

.qr-overlay.show,.qr-card {
  display: flex;
}

.qr-card {
  background: var(--bg-elevated);
  border-radius: 0.9rem;
  border: 1px solid var(--border-strong);
  padding: 1.35rem 1.4rem;
  max-width: 760px;
  width: 100%;
  flex-direction: column;
  gap: 0.6rem;
  font-size: 0.85rem;
}

.qr-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 0.5rem;
}

.qr-title {
  font-weight: 500;
}

.qr-body {
  gap: 0.75rem;
}

.qr-body,.qr-box {
  display: flex;
  align-items: center;
}

.qr-box {
  width: min(360px, 80vw);
  aspect-ratio: 1 / 1;
  height: auto;
  border-radius: 1.2rem;
  border: 1px solid var(--border-strong);
  background: linear-gradient(145deg, rgba(255, 255, 255, 0.4), rgba(248, 251, 255, 0.6));
  justify-content: center;
  position: relative;
  overflow: hidden;
  box-shadow: 0 25px 45px rgba(15, 23, 42, 0.25);
}

.qr-box canvas {
  border-radius: inherit;
  background: #ffffff;
}

.qr-box canvas,.qr-box img {
  width: 100%;
  height: 100%;
  display: block;
}

.qr-box img {
  object-fit: cover;
}

.qr-logo {
  width: clamp(56px, 24%, 92px);
  height: clamp(56px, 24%, 92px);
  border-radius: 1.4rem;
  background: #fff;
  border: clamp(4px, 1.8vw, 6px) solid #fff;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: clamp(0.25rem, 1.2vw, 0.4rem);
  pointer-events: none;
  z-index: 2;
}

.qr-logo,.qr-logo-img {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}

.qr-logo-img {
  width: 78%;
  height: 78%;
  object-fit: contain;
  display: block;
  filter: none;
}

[data-theme="dark"] .qr-card {
  background: #121212;
  border-color: #242424;
}

[data-theme="dark"] .qr-box {
  box-shadow: 0 25px 45px rgba(0, 0, 0, 0.45);
}

[data-theme="dark"] .qr-box,[data-theme="dark"] .qr-logo {
  border-color: #ffffff;
  background: #ffffff;
}

.qr-info {
  display: flex;
  flex-direction: column;
  gap: 0.35rem;
}

.qr-link {
  font-size: 0.8rem;
  word-break: break-all;
  color: var(--accent);
}

.qr-footer {
  display: flex;
  justify-content: flex-end;
  gap: 0.4rem;
  margin-top: 0.35rem;
}

.hidden {
  display: none !important;
}

.btn {
  transition: background-color 0.15s ease-out,
                  border-color 0.15s ease-out,
                  color 0.15s ease-out;
}

.btn-ghost.btn-sm {
  background: var(--bg-elevated);
  border-radius: 999px;
  padding-inline: 0.65rem;
}

.btn-ghost.btn-sm:hover {
  background: color-mix(in srgb, var(--accent-soft) 30%, var(--bg-elevated) 70%);
}

.btn-ghost.btn-sm:hover,.btn:hover {
  border-color: color-mix(in srgb, var(--btn-border-neutral) 75%, var(--accent) 25%);
  color: var(--accent-strong);
  background-color: color-mix(in srgb, var(--accent-soft) 35%, var(--bg-elevated) 65%);
  box-shadow: none;
}

.btn-primary:hover {
  border-color: var(--accent-strong);
}

.btn-danger:hover {
  background-color: rgba(220, 38, 38, 0.06);
}

.btn.queue-ban-btn:hover,
.btn.queue-ban-btn:focus-visible,
.btn.queue-delete-btn:hover,
.btn.queue-delete-btn:focus-visible {
  border-color: var(--danger);
  color: var(--danger);
  background: color-mix(in srgb, var(--danger) 12%, var(--bg-soft) 88%);
}

.icon-btn:hover {
  border-color: var(--accent);
  color: var(--accent-strong);
}

.icon-btn:hover,
.icon-btn:focus-visible,
.queue-action:hover {
  border-color: var(--accent);
  color: var(--accent-strong);
  background: color-mix(in srgb, var(--accent) 12%, var(--bg-soft) 88%);
}

.queue-action:focus-visible {
  border-color: var(--accent);
  color: var(--accent-strong);
  background: color-mix(in srgb, var(--accent-soft) 32%, var(--bg-elevated) 68%);
  outline: var(--focus-outline);
  outline-offset: 2px;
  box-shadow: none;
}

.app-footer {
  border-top: 1px solid var(--border-subtle);
  padding: 1.25rem 1.5rem 1.4rem;
  font-size: 0.8rem;
  color: var(--text-secondary);
  display: flex;
  justify-content: center;
  align-items: flex-start;
  gap: 0.75rem;
  background: var(--bg);
  flex-shrink: 0;
  width: 100%;
  margin-top: auto;
  box-shadow: none;
}

.app-footer-left,
.app-footer-right {
  display: flex;
  align-items: center;
  gap: 0.6rem;
}

.app-footer-left a {
  text-decoration: none;
  color: var(--text-secondary);
}

.app-footer-left a:hover {
  color: var(--accent-strong);
}

.footer-label,.footer-lang {
  color: var(--text-secondary);
}

.footer-lang {
  border-radius: 999px;
  border: 1px solid var(--border-subtle);
  background: transparent;
  padding: 0.15rem 0.5rem;
  font-size: 0.78rem;
  cursor: pointer;
  transition: background-color 0.15s ease-out,
              border-color 0.15s ease-out,
              color 0.15s ease-out;
}

.footer-lang:hover {
  background: var(--bg-soft);
}

.footer-lang:hover,.footer-lang.active {
  border-color: var(--accent);
  color: var(--accent-strong);
}

.footer-lang.active {
  background: var(--accent-soft);
}

.message-to-teacher .message-body {
  border-color: var(--accent);
}

.account-controls {
  position: relative;
  display: flex;
  align-items: center;
  gap: 0.4rem;
}

.account-btn {
  border-radius: 999px;
  border: 1px solid var(--border-subtle);
  padding: 0.25rem 0.6rem;
  font-size: 0.8rem;
  display: inline-flex;
  align-items: center;
  gap: 0.3rem;
  cursor: pointer;
}

.account-btn i {
  width: 0.95rem;
  height: 0.95rem;
}

.account-btn:hover {
  border-color: var(--accent);
  color: var(--accent-strong);
}

.account-menu {
  position: absolute;
  right: 0;
  top: 130%;
  min-width: 140px;
  border-radius: 0.5rem;
  border: 1px solid var(--border-subtle);
  background: var(--bg-elevated);
  box-shadow: 0 10px 25px rgba(15, 23, 42, 0.18);
  padding: 0.25rem;
  display: flex;
  flex-direction: column;
  z-index: 20;
}

.account-menu button {
  border: none;
  background: transparent;
  text-align: left;
  padding: 0.35rem 0.5rem;
  font-size: 0.8rem;
  cursor: pointer;
  color: var(--text-secondary);
  border-radius: 0.35rem;
}

.account-menu button:hover {
  background: var(--bg-soft);
  color: var(--accent-strong);
}

.app-header-left {
  display: flex;
  align-items: center;
  gap: 0.6rem;
}

body[data-theme="dark"] {
  background: var(--bg);
  color: var(--text-primary);
}

[data-theme="dark"] .app-header {
  background: var(--bg-elevated);
  border-color: var(--border-strong);
  box-shadow: 0 10px 20px rgba(0, 0, 0, 0.28);
}

[data-theme="dark"] .app-title span.badge {
  background: rgba(255, 255, 255, 0.04);
  border-color: var(--border-subtle);
  color: var(--text-secondary);
}

[data-theme="dark"] .btn {
  color: var(--text-primary);
  border-color: var(--btn-gray-border);
}

[data-theme="dark"] .btn.queue-ban-btn,
[data-theme="dark"] .btn.queue-delete-btn {
  color: var(--text-secondary);
}

[data-theme="dark"] .btn.queue-ban-btn:hover,
[data-theme="dark"] .btn.queue-ban-btn:focus-visible,
[data-theme="dark"] .btn.queue-delete-btn:hover,
[data-theme="dark"] .btn.queue-delete-btn:focus-visible {
  color: var(--danger);
}

[data-theme="dark"] .btn-ghost,
    [data-theme="dark"] .icon-btn {
  background: var(--btn-gray-bg);
  border-color: var(--btn-gray-border);
  box-shadow: none;
}

[data-theme="dark"] .btn-primary {
  border-color: var(--btn-blue-border);
  background: var(--btn-blue-bg);
  color: #e7ebff;
  box-shadow: none;
}

[data-theme="dark"] .btn-danger {
  border-color: var(--btn-red-border);
  color: #fdd5d5;
  background: var(--btn-red-bg);
}

[data-theme="dark"] .app-nav .btn,
    [data-theme="dark"] .app-controls .btn-ghost,
    [data-theme="dark"] .icon-btn {
  border-color: var(--border-subtle);
  color: var(--text-primary);
}

[data-theme="dark"] .app-nav .btn:hover,
    [data-theme="dark"] .app-controls .btn-ghost:hover,
    [data-theme="dark"] .icon-btn:hover {
  border-color: var(--btn-gray-border);
  background: var(--btn-gray-hover);
  color: var(--text-primary);
}

[data-theme="dark"] .btn-primary:hover {
  background: var(--btn-blue-hover);
  border-color: var(--btn-blue-border);
  color: #eef2ff;
}

[data-theme="dark"] .btn-danger:hover {
  background: var(--btn-red-hover);
  border-color: var(--btn-red-border);
  color: #ffe5e9;
}

[data-theme="dark"] .btn-ghost:hover,
    [data-theme="dark"] .icon-btn:hover {
  background: var(--btn-gray-hover);
}

[data-theme="dark"] .send-btn {
  background: var(--btn-blue-bg);
  border-color: var(--btn-blue-border);
  color: #e7ebff;
}

[data-theme="dark"] .send-btn:hover {
  background: var(--btn-blue-hover);
  border-color: var(--btn-blue-border);
}

[data-theme="dark"] .panel {
  background: var(--bg-elevated);
  border-color: var(--border-strong);
  box-shadow: 0 10px 22px rgba(0, 0, 0, 0.26);
}

[data-theme="dark"] .panel-header,
    [data-theme="dark"] .panel-footer {
  background: var(--panel-header);
  border-color: var(--border-subtle);
}

[data-theme="dark"] .panel-subtitle {
  color: var(--text-secondary);
}

[data-theme="dark"] .chat-input {
  box-shadow: 0 -8px 22px rgba(0, 0, 0, 0.3);
}

[data-theme="dark"] .chat-input,[data-theme="dark"] .chat-textarea {
  border-color: var(--border-strong);
}

[data-theme="dark"] .chat-textarea {
  color: var(--text-primary);
}

[data-theme="dark"] .chat-composer {
  background: var(--bg-soft);
  border-color: var(--border-strong);
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.06);
}

[data-theme="dark"] .composer-btn {
  background: transparent;
}

[data-theme="dark"] .composer-send {
  background: transparent;
  color: var(--text-secondary);
  border: none;
  box-shadow: none;
}

[data-theme="dark"] .composer-send.can-send {
  color: var(--accent);
}

[data-theme="dark"] .composer-send:not(.can-send):hover {
  color: #f3f4f6;
}

[data-theme="dark"] .reaction-menu {
  background: var(--bg-elevated);
  background: var(--bg);
  border-color: var(--border-strong);
}

[data-theme="dark"] .reaction-chip,[data-theme="dark"] .reply-preview {
  background: var(--bg-elevated);
  border-color: var(--border-strong);
}

[data-theme="dark"] .reply-preview {
  border-left-color: var(--accent);
  box-shadow: none;
}

[data-theme="dark"] .reply-preview .icon-btn {
  background: transparent;
  border-color: var(--border-subtle);
  color: var(--text-primary);
  box-shadow: none;
}

[data-theme="dark"] .reply-preview .icon-btn:hover,
[data-theme="dark"] .reply-preview .icon-btn:focus-visible {
  color: #f3f4f6;
  border-color: var(--accent);
}

[data-theme="dark"] .reply-preview .icon-btn:hover svg,
[data-theme="dark"] .reply-preview .icon-btn:focus-visible svg {
  color: #f3f4f6;
  stroke: #f3f4f6;
}

[data-theme="dark"] .reply-preview .icon-btn:hover i,
[data-theme="dark"] .reply-preview .icon-btn:focus-visible i {
  color: #f3f4f6;
}

[data-theme="dark"] .dropdown-link.danger:hover {
  background: rgba(248, 113, 113, 0.12);
}

[data-theme="dark"] .mobile-tab-btn.mobile-tab-more {
  background: var(--accent-soft);
  border-color: var(--border-strong);
  color: var(--text-primary);
}

[data-theme="dark"] .mobile-menu-footer-links a,
    [data-theme="dark"] .mobile-menu-links a {
  background: var(--bg-elevated);
  border-color: var(--btn-gray-border);
  color: var(--text-primary);
  box-shadow: none;
}

[data-theme="dark"] .mobile-menu-footer-links a:hover,
    [data-theme="dark"] .mobile-menu-links a:hover {
  color: #e5e7eb;
  border-color: var(--btn-blue-border);
  background: var(--btn-blue-hover);
  box-shadow: none;
}

[data-theme="dark"] .app-footer {
  box-shadow: 0 -8px 16px rgba(0, 0, 0, 0.18);
}

[data-theme="dark"] .app-footer,[data-theme="dark"] .footer-lang {
  background: var(--bg-elevated);
  border-color: var(--border-strong);
}

[data-theme="dark"] .footer-lang {
  color: var(--text-primary);
  box-shadow: 0 8px 14px rgba(0, 0, 0, 0.22);
}

[data-theme="dark"] .footer-lang.active {
  border-color: var(--accent);
  background: rgba(96, 165, 250, 0.16);
  color: var(--accent-strong);
}

[data-theme="dark"] .status-ignored,
    [data-theme="dark"] .status-hidden {
  border-color: #475569;
  color: #cbd5f5;
}

[data-theme="dark"] .hero-icon.muted {
  background: rgba(148, 163, 184, 0.12);
  color: var(--text-secondary);
}

[data-theme="dark"] .qr-overlay {
  background: rgba(3, 6, 12, 0.7);
}

html, body {
  overflow-x: hidden;
}

html, body,body.app, .app {
  height: auto;
  min-height: var(--app-viewport-height);
}

body.app, .app {
  display: flex;
  flex-direction: column;
  margin: 0;
  padding: 0;
}

.app-shell,.profile-page {
  flex: 1 1 auto;
  display: flex;
  flex-direction: column;
  width: 100%;
  overflow-x: hidden;
}

.profile-page {
  min-height: 0;
}

.profile-container {
  flex: 1 1 auto;
  display: flex;
  flex-direction: column;
  gap: 1rem;
  max-width: 980px;
  margin: 0 auto;
  padding: 1.25rem 1.2rem 1.8rem;
  width: 100%;
}

.profile-container .panel {
  flex: 0 0 auto;
  height: auto;
}

.profile-container .panel-body {
  flex: 1 1 auto;
  min-height: 0;
}

.layout.teacher .teacher-panels {
  grid-column: 2 / span 1;
  display: grid;
  grid-template-columns: 1fr;
  gap: 0.75rem;
  min-height: 0;
  grid-auto-rows: 1fr;
}

.layout.teacher .teacher-panels .panel {
  min-height: 0;
  height: 100%;
}

.layout .panel {
  height: 100%;
}

.footer-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(190px, 1fr));
  align-items: flex-start;
  gap: 1.25rem 2rem;
  width: 100%;
  max-width: 1180px;
}

.footer-column {
  display: grid;
  gap: 0.35rem;
}

.footer-heading {
  font-weight: 800;
  letter-spacing: 0.01em;
  font-size: 0.96rem;
  color: var(--text-primary);
}

.footer-links-list {
  display: grid;
  gap: 0.25rem;
  font-size: 0.88rem;
}

.footer-links-list a {
  color: var(--text-secondary);
  text-decoration: none;
  font-weight: 300;
  line-height: 1.35;
}

.footer-links-list a:hover {
  color: var(--accent-strong);
}

.footer-muted {
  color: var(--text-secondary);
  font-size: 0.88rem;
  line-height: 1.4;
}

.footer-social {
  align-self: flex-start;
}

.footer-social-links {
  display: inline-flex;
  gap: 0.6rem;
  align-items: center;
}

.footer-social-links a {
  width: 2.4rem;
  height: 2.4rem;
  border-radius: 50%;
  border: 1px solid var(--border-strong);
  display: inline-flex;
  align-items: center;
  justify-content: center;
  color: var(--text-primary);
  background: var(--bg-elevated);
  text-decoration: none;
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.4);
  transition: transform 0.12s ease, border-color 0.12s ease, color 0.12s ease;
}

.footer-social-links a:hover {
  transform: translateY(-2px);
  border-color: var(--accent);
  color: var(--accent-strong);
}

.footer-social-links i {
  width: 1.1rem;
  height: 1.1rem;
}

.room-header {
  margin-bottom: 0.85rem;
  height: auto;
  min-height: auto;
  flex: 0 0 auto;
  overflow: visible;
}

.room-header .panel-header {
  border-radius: 0.75rem;
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  gap: 1rem;
  flex-wrap: wrap;
}

.room-header-bar {
  width: 100%;
}

.room-header-main {
  gap: 0.1rem;
  flex: 1 1 320px;
  min-width: 280px;
}

.room-header-main,.room-title-stack {
  display: flex;
  flex-direction: column;
}

.inline-edit-inline {
  display: inline-flex;
  align-items: center;
  gap: 0.35rem;
}

.inline-edit-trigger.active {
  opacity: 0;
  visibility: hidden;
  pointer-events: none;
}

.room-title-row {
  display: flex;
  align-items: center;
  gap: 0.65rem;
}

.room-title-icon {
  width: 2.6rem;
  height: 2.6rem;
  border-radius: 0.9rem;
  background: var(--bg-soft);
  border: 1px solid var(--border-subtle);
  display: inline-flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
}

.room-title-stack {
  gap: 0.2rem;
  min-width: 0;
}

.room-header-aside {
  display: flex;
  flex-direction: row;
  align-items: center;
  gap: 0.65rem;
  min-width: 200px;
  flex: 0 0 auto;
}

.room-header .panel-actions {
  justify-content: flex-end;
  flex-wrap: wrap;
  gap: 0.5rem;
}

.room-header .panel-actions .btn {
  flex: 0 0 auto;
}

.room-status {
  align-self: center;
  font-weight: 600;
}

.room-header .panel-title {
  align-items: flex-start;
  margin-bottom: 0;
}

.room-header .panel-title i {
  margin-top: 0;
  align-self: flex-start;
}

.room-description {
  position: relative;
  line-height: 1.45;
  white-space: pre-line;
  word-break: break-word;
}

.room-description-block {
  display: flex;
  flex-direction: column;
  gap: 0.15rem;
  margin-top: -1rem;
}

.room-description-row {
  display: flex;
  align-items: flex-start;
  justify-content: flex-start;
  gap: 0.5rem;
}

.room-description-row .room-description {
  flex: 1;
  text-align: left;
}

.room-description-actions {
  display: flex;
  gap: 0.4rem;
  margin-left: auto;
}

.room-description-block .inline-edit-form {
  width: 100%;
  margin: 0;
}

.room-description.is-collapsible {
  cursor: pointer;
}

.room-description.is-collapsed {
  max-height: 4.6rem;
  overflow: hidden;
}

.room-description.is-collapsible::after {
  content: "";
  position: absolute;
  left: 0;
  right: 0;
  bottom: 0;
  height: 1.6rem;
  background: linear-gradient(180deg, rgba(255, 255, 255, 0), var(--bg-elevated));
  pointer-events: none;
  opacity: 0;
  transition: opacity 0.15s ease;
}

[data-theme="dark"] .room-description.is-collapsible::after {
  background: linear-gradient(180deg, rgba(15, 23, 42, 0), var(--panel-header));
}

.room-description.is-collapsible.is-collapsed::after {
  opacity: 1;
}

.room-description.is-collapsible:focus-visible {
  outline: 2px solid var(--accent);
  outline-offset: 2px;
  border-radius: 0.5rem;
}


.app-mobile-tabs {
  display: none;
}

.empty-state {
  padding: 0.75rem 0.9rem;
  border: 1px dashed var(--border-subtle);
  border-radius: var(--radius-lg);
  color: var(--text-secondary);
  text-align: center;
}

.message.message-empty {
  justify-content: center;
}

.message-empty .message-body,
.queue-panel .empty-state,
.history-panel .empty-state {
  display: grid;
  gap: 0.4rem;
  justify-items: center;
  text-align: center;
  width: 100%;
  max-width: none;
  padding: var(--list-rhythm);
  border: 1px dashed var(--border-subtle);
  border-radius: var(--radius-lg);
  background: color-mix(in srgb, var(--bg-soft) 85%, transparent);
  color: color-mix(in srgb, var(--text-primary) 55%, var(--text-secondary));
  font-size: 0.9rem;
  box-shadow: none;
}

.message-empty .message-text {
  color: color-mix(in srgb, var(--text-primary) 55%, var(--text-secondary));
  font-weight: 600;
}

.message-empty .message-body::before,
.queue-panel .empty-state::before,
.history-panel .empty-state::before {
  content: "\1F4AC";
  font-size: 1.5rem;
  opacity: 0.9;
}

.message-empty .message-body::after,
.queue-panel .empty-state::after,
.history-panel .empty-state::after {
  content: "Add a new message or question to get started.";
  font-size: 0.8rem;
  color: var(--text-secondary);
}

.mobile-menu-btn,
.mobile-menu-fab {
  display: none !important;
}

.mobile-menu-btn i {
  width: 1.1rem;
  height: 1.1rem;
}

.chat-pane > .chat-input {
  position: static;
  inset: auto;
  margin: 0;
}

.user-menu {
  position: relative;
  display: inline-flex;
  align-items: center;
}

.user-menu summary {
  list-style: none;
}

.user-menu summary::-webkit-details-marker,
.user-menu summary::marker {
  display: none;
}

.user-menu-trigger {
  cursor: pointer;
}

.user-menu-dropdown {
  position: absolute;
  right: 0;
  top: calc(100% + 0.4rem);
  min-width: 180px;
  padding: 0.35rem;
  border-radius: 0.65rem;
  border: 1px solid var(--border-subtle);
  background: var(--bg-elevated);
  box-shadow: 0 12px 28px rgba(15, 23, 42, 0.16);
  display: flex;
  flex-direction: column;
  gap: 0.1rem;
  opacity: 0;
  transform: translateY(-4px);
  pointer-events: none;
  transition: opacity 0.12s ease-out, transform 0.12s ease-out;
  z-index: 30;
}

.user-menu[open] .user-menu-dropdown {
  opacity: 1;
  transform: translateY(0);
  pointer-events: auto;
}

.dropdown-link {
  display: block;
  width: 100%;
  border: none;
  background: transparent;
  text-align: left;
  padding: 0.45rem 0.55rem;
  font-size: 0.85rem;
  color: var(--text-primary);
  text-decoration: none;
  border-radius: 0.45rem;
  cursor: pointer;
}

.dropdown-link.setting {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 0.5rem;
}

.dropdown-link .pill {
  display: inline-flex;
  align-items: center;
  padding: 0.15rem 0.5rem;
  border-radius: 999px;
  border: 1px solid var(--border-subtle);
  font-size: 0.75rem;
  color: var(--text-secondary);
  background: var(--bg-soft);
}

.dropdown-link.setting.off .pill {
  color: var(--text-secondary);
  opacity: 0.85;
}

.dropdown-link:hover {
  background: var(--bg-soft);
  color: var(--accent-strong);
}

.dropdown-link.danger {
  color: var(--danger);
}

.dropdown-link.danger:hover {
  background: #fef2f2;
}

.mobile-tab-btn.mobile-tab-more {
  background: rgba(255, 255, 255, 0.96);
  border: 1px solid var(--border-strong);
  font-weight: 700;
}

.mobile-menu-footer {
  display: grid;
  gap: 0.6rem;
}

.mobile-menu-footer-links {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
  gap: 0.5rem;
}

.mobile-menu-footer-links a {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 0.35rem;
  padding: 0.65rem 0.75rem;
  border-radius: 0.85rem;
  border: 1px solid var(--border-strong);
  background: var(--bg-elevated);
  text-decoration: none;
  color: var(--text-primary);
  font-weight: 600;
}

.mobile-menu-footer-links a:hover {
  border-color: var(--accent);
  color: var(--accent-strong);
}

.mobile-menu-footer-lang {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(90px, 1fr));
  gap: 0.4rem;
}

.mobile-menu-footer-lang button {
  width: 100%;
  border-radius: 0.85rem;
  border: 1px solid var(--border-strong);
  background: var(--bg-soft);
  padding: 0.6rem 0.7rem;
  font-weight: 700;
  cursor: pointer;
  color: var(--text-primary);
}

.panel-actions {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  flex-wrap: wrap;
  justify-content: flex-end;
}

.eyebrow {
  text-transform: uppercase;
  letter-spacing: 0.08em;
  font-weight: 700;
  font-size: 0.75rem;
  color: var(--text-secondary);
}

.dashboard-hero {
  position: relative;
  display: flex;
  flex-direction: column;
  align-items: stretch;
  width: 100%;
  gap: 0.75rem;
  padding: 1.25rem 1.3rem;
  background: var(--bg-elevated);
  border: 1px solid var(--border-strong);
  border-radius: 0.75rem;
  box-shadow: 0 12px 24px rgba(15, 23, 42, 0.08);
  overflow: visible;
}

[data-theme="dark"] .dashboard-hero {
  background: var(--bg-elevated);
  box-shadow: 0 14px 28px rgba(0, 0, 0, 0.26);
}

.dashboard-hero__content {
  display: flex;
  flex-direction: column;
  gap: 0.4rem;
  max-width: 100%;
  width: 100%;
}

.dashboard-hero__title {
  margin: 0;
  font-size: 1.6rem;
  line-height: 1.2;
  word-break: break-word;
  white-space: normal;
}

.dashboard-hero .panel-subtitle {
  word-break: break-word;
  white-space: normal;
}

.dashboard-hero__actions {
  display: flex;
  align-items: center;
  flex-wrap: wrap;
  gap: 0.5rem;
  width: 100%;
}

.dashboard-hero__stats {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
  gap: 0.5rem;
}

.hero-stat {
  display: flex;
  align-items: center;
  gap: 0.6rem;
  padding: 0.7rem 0.75rem;
  border-radius: 0.85rem;
  border: 1px solid var(--border-subtle);
  background: var(--bg-elevated);
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.3);
}

[data-theme="dark"] .hero-stat {
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.04);
}

.hero-icon {
  width: 2.25rem;
  height: 2.25rem;
  border-radius: 0.85rem;
  background: var(--accent-soft);
  color: var(--accent-strong);
  display: inline-flex;
  align-items: center;
  justify-content: center;
}

.hero-icon.success {
  background: rgba(22, 163, 74, 0.12);
  color: var(--ok);
}

.hero-icon.muted {
  background: var(--bg-soft);
  color: var(--text-secondary);
}

.hero-stat-label {
  font-size: 0.78rem;
  color: var(--text-secondary);
}

.hero-stat-value {
  font-size: 1.1rem;
  font-weight: 700;
}

.create-hero {
  background: var(--bg-elevated);
  border-color: var(--border-subtle);
  gap: 0;
  padding: 0;
}

.create-hero-body {
  padding: 0.85rem 0.95rem 1rem;
  display: flex;
  flex-direction: column;
  gap: 0.6rem;
}

.create-hero-actions {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  flex-wrap: wrap;
}

.create-hero-tags {
  display: flex;
  flex-wrap: wrap;
  gap: 0.35rem;
}

.create-hero-tags span {
  padding: 0.25rem 0.55rem;
  border-radius: 999px;
  border: 1px solid var(--border-subtle);
  background: var(--bg-soft);
  color: var(--text-secondary);
  font-size: 0.85rem;
}

.create-layout {
  display: grid;
  grid-template-columns: minmax(0, 1.5fr) minmax(300px, 1fr);
  gap: 0.85rem;
  align-items: start;
}

.create-form-card,
    .create-preview {
  overflow: visible;
}

.create-form-body {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
  padding: 0.95rem 1.05rem 1.1rem;
}

.form-alert {
  border: 1px solid #f97316;
  background: rgba(249, 115, 22, 0.08);
  border-radius: 0.75rem;
  padding: 0.65rem 0.75rem;
  color: #9a3412;
}

[data-theme="dark"] .form-alert {
  background: rgba(249, 115, 22, 0.12);
  color: #fdba74;
  border-color: #fb923c;
}

.form-alert ul {
  margin: 0.2rem 0 0;
  padding-left: 1rem;
  display: grid;
  gap: 0.25rem;
}

.form-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 0.75rem;
}

.input-field {
  display: flex;
  flex-direction: column;
  gap: 0.35rem;
  padding: 0.65rem 0.7rem;
  border: 1px solid var(--border-subtle);
  border-radius: 0.8rem;
  background: var(--bg-elevated);
}

.input-label {
  font-weight: 700;
  display: block;
}

.input-label,.field-control {
  font-size: 0.95rem;
  color: var(--text-primary);
}

.field-control {
  width: 100%;
  border: 1px solid var(--border-strong);
  border-radius: 0.65rem;
  background: var(--bg-elevated);
  padding: 0.6rem 0.65rem;
  transition: border 0.15s ease, box-shadow 0.15s ease, background 0.15s ease;
}

[data-theme="dark"] .field-control {
  background: var(--bg);
  border-color: var(--border-subtle);
}

.field-control:focus {
  outline: none;
  border-color: var(--accent);
  box-shadow: none;
  background: var(--bg-elevated);
}

.field-control::placeholder {
  color: var(--text-secondary);
}

.input-hint {
  font-size: 0.82rem;
  color: var(--text-secondary);
  line-height: 1.45;
}

.form-footer {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 0.75rem;
  flex-wrap: wrap;
  margin-top: 0.35rem;
}

.form-footnote {
  display: inline-flex;
  align-items: center;
  gap: 0.4rem;
  color: var(--text-secondary);
  font-size: 0.86rem;
}

.create-switch .switch-track {
  box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.08);
}

.create-preview {
  background: var(--bg-elevated);
}

.create-preview-body {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
  padding: 0.9rem 1rem 1rem;
}

.preview-room-card {
  pointer-events: none;
}

.preview-room-card .room-card-actions .btn {
  cursor: default;
}

.create-tips {
  list-style: none;
  margin: 0;
  padding: 0;
  display: grid;
  gap: 0.5rem;
}

.create-tip {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.6rem 0.7rem;
  border-radius: 0.75rem;
  border: 1px solid var(--border-subtle);
  background: var(--bg-soft);
  color: var(--text-secondary);
  font-size: 0.9rem;
}

.create-tip i {
  width: 1rem;
  height: 1rem;
  color: var(--accent-strong);
}

.rooms-panel .panel-body {
  padding: 0.95rem 1.05rem 1.1rem;
  gap: 0.85rem;
  overflow: auto;
  max-height: 70vh;
}

.rooms-grid {
  display: grid;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  gap: 0.85rem;
}

.room-card {
  display: flex;
  flex-direction: column;
  gap: 0.6rem;
  padding: 0.85rem 0.95rem 0.9rem;
  background: var(--bg-elevated);
  border-color: var(--border-strong);
  box-shadow: 0 10px 22px rgba(15, 23, 42, 0.08);
  overflow: visible;
}

[data-theme="dark"] .room-card {
  background: var(--bg-elevated);
  box-shadow: 0 12px 24px rgba(0, 0, 0, 0.24);
}

.room-card-header {
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  gap: 0.5rem;
}

.room-card-title {
  display: inline-flex;
  gap: 0.5rem;
  font-weight: 700;
  font-size: 1rem;
}

.room-card-title,.room-card-meta {
  align-items: center;
  flex-wrap: wrap;
}

.room-card-meta {
  display: flex;
  gap: 0.35rem;
  color: var(--text-secondary);
  font-size: 0.85rem;
}

.dot-separator {
  color: var(--border-strong);
}

.room-card-desc {
  margin: 0.15rem 0 0;
  font-size: 0.92rem;
  line-height: 1.45;
  display: block;
  white-space: normal;
  word-break: break-word;
  overflow-wrap: anywhere;
}

.room-card-stats {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
  gap: 0.5rem;
}

.room-stat {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem 0.55rem;
  border-radius: 0.7rem;
  border: 1px solid var(--border-subtle);
  background: var(--bg-soft);
}

.room-stat-icon {
  width: 2.1rem;
  height: 2.1rem;
  border-radius: 0.75rem;
  display: inline-flex;
  align-items: center;
  justify-content: center;
}

.room-stat-icon,.room-stat-icon.accent,.room-stat-icon.neutral {
  background: var(--bg-elevated);
  color: var(--text-primary);
}

.room-stat-label {
  font-size: 0.75rem;
  color: var(--text-secondary);
}

.room-stat-value {
  font-weight: 700;
  font-size: 0.95rem;
}

.room-card-actions {
  display: flex;
  align-items: center;
  justify-content: flex-start;
  gap: 0.5rem;
  flex-wrap: wrap;
}

.room-card-actions .btn {
  justify-content: center;
}

.room-card-actions .btn,.room-card-actions form,
.room-card-actions a,.room-delete-btn {
  flex: 1 1 0;
  width: 100%;
}

.room-delete-btn {
  margin-left: 0;
}

.join-hero {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 1.2rem;
  padding: 1.35rem 1.4rem 1.5rem;
  align-items: start;
  align-content: start;
  width: 100%;
  min-width: 0;
}

.join-hero__content {
  display: flex;
  flex-direction: column;
  gap: 0.45rem;
}

.join-hero__title {
  margin: 0;
  font-size: 1.6rem;
}

.join-hero__card {
  border: 1px solid var(--border-subtle);
  border-radius: 0.85rem;
  background: var(--bg-elevated);
  padding: 1rem 1.1rem 1.15rem;
  box-shadow: 0 12px 24px rgba(15, 23, 42, 0.08);
  height: 100%;
}

.join-hero__card,.join-form {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
}

.join-actions {
  display: flex;
  justify-content: space-between;
  gap: 0.65rem;
  flex-wrap: wrap;
}

.join-actions .btn {
  flex: 1 1 auto;
  justify-content: center;
}

.error-page {
  min-height: calc(var(--app-viewport-height, 100vh) - 140px);
  display: grid;
  place-items: center;
  padding: 1.4rem 1.25rem;
  position: relative;
}

.error-panel {
  position: relative;
  overflow: hidden;
  gap: 0.75rem;
  padding: 1.35rem 1.4rem 1.55rem;
  max-width: 780px;
  margin: 0 auto;
  background: var(--bg-elevated);
  border: 1px solid var(--border-strong);
  box-shadow: 0 14px 32px rgba(15, 23, 42, 0.12);
}

.error-panel::before,
.error-panel::after {
  content: "";
  position: absolute;
  inset: -20%;
  background: radial-gradient(circle at 20% 30%, rgba(37, 99, 235, 0.08), transparent 42%),
              radial-gradient(circle at 80% 20%, rgba(16, 185, 129, 0.08), transparent 38%),
              radial-gradient(circle at 60% 80%, rgba(249, 115, 22, 0.08), transparent 34%);
  filter: blur(32px);
  z-index: 0;
}

.error-panel::after {
  inset: -10%;
  background: radial-gradient(circle at 50% 50%, rgba(255, 255, 255, 0.4), transparent 45%);
  opacity: 0.35;
}

.error-sheen,
.error-glow {
  position: absolute;
  inset: 0;
  pointer-events: none;
  z-index: 1;
}

.error-sheen {
  background: linear-gradient(135deg, transparent 0%, rgba(255, 255, 255, 0.45) 40%, transparent 75%);
  opacity: 0.5;
  mix-blend-mode: screen;
}

.error-glow {
  background: linear-gradient(180deg, rgba(37, 99, 235, 0.06), rgba(255, 255, 255, 0));
}

.error-eyebrow,.error-title {
  position: relative;
  z-index: 2;
}

.error-title {
  margin: 0;
  font-size: 1.9rem;
  line-height: 1.2;
  color: var(--text-primary);
}

.error-code {
  font-size: 3.4rem;
  font-weight: 800;
  letter-spacing: -0.03em;
  background: linear-gradient(120deg, var(--accent), #10b981, #f97316);
  -webkit-background-clip: text;
  background-clip: text;
  color: transparent;
  text-shadow: 0 4px 16px rgba(15, 23, 42, 0.16);
}

.error-code,.error-lead {
  position: relative;
  z-index: 2;
}

.error-lead {
  font-size: 0.97rem;
  line-height: 1.55;
  color: var(--text-primary);
}

.error-meta {
  position: relative;
  z-index: 2;
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
}

.error-chip {
  display: inline-flex;
  align-items: center;
  gap: 0.35rem;
  padding: 0.35rem 0.65rem;
  border-radius: 0.75rem;
  border: 1px solid var(--border-strong);
  background: var(--bg-elevated);
  font-size: 0.82rem;
  color: var(--text-primary);
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.22);
}

.error-chip i {
  width: 1rem;
  height: 1rem;
  color: var(--accent-strong);
}

.error-actions {
  position: relative;
  z-index: 2;
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
}

.error-actions .btn {
  min-width: 140px;
}

[data-theme="dark"] .error-panel {
  background: #0d0d0f;
  border-color: #1f1f1f;
  box-shadow: 0 18px 36px rgba(0, 0, 0, 0.42);
}

[data-theme="dark"] .error-panel::before,
[data-theme="dark"] .error-panel::after {
  opacity: 0.28;
}

[data-theme="dark"] .error-chip {
  background: var(--bg);
  border-color: var(--border-strong);
  color: var(--text-primary);
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.06);
}

.room-card-actions .btn.btn-ghost {
  border-color: var(--border-subtle);
}

.empty-actions {
  margin-top: 0.6rem;
  display: flex;
  justify-content: center;
}

.status-active {
  border-color: var(--accent);
  background: var(--accent-soft);
  color: var(--accent-strong);
}

.status-finished {
  border-color: #16a34a;
  background: rgba(22, 163, 74, 0.25);
  color: #12b76a;
}

.status-archived {
  border-color: var(--border-strong);
  background: var(--bg-soft);
  color: var(--text-secondary);
}

.room-controls-body {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.room-controls-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
  gap: 1rem;
}

.room-control-card {
  border: 1px solid var(--border-strong);
  border-radius: 0.75rem;
  padding: 0.75rem;
  background: var(--bg-soft);
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
}

[data-theme="dark"] .room-control-card {
  background: var(--bg-elevated);
  border-color: var(--border-subtle);
}

.room-control-actions {
  justify-content: flex-end;
}

.room-control-actions,.status-row {
  display: flex;
  gap: 0.5rem;
  align-items: center;
}

.status-row {
  justify-content: space-between;
}

.form-alert.success {
  border-color: var(--ok);
  background: rgba(16, 185, 129, 0.12);
  color: #047857;
}

[data-theme="dark"] .form-alert.success {
  background: rgba(52, 211, 153, 0.18);
  color: #34d399;
}

.inline-editable {
  position: relative;
  display: flex;
  align-items: flex-start;
  justify-content: flex-start;
  gap: 0.35rem;
  width: 100%;
}

.inline-edit-trigger {
  opacity: 0;
  transition: opacity 0.2s ease;
  padding: 0.2rem;
  border-radius: 0.5rem;
}

.inline-edit-trigger.icon-btn {
  width: 2.2rem;
  min-width: 2.2rem;
  height: 2.2rem;
  flex: 0 0 2.2rem;
}

.inline-edit-display {
  flex: 1 1 auto;
}

.inline-editable:hover .inline-edit-trigger,
.inline-editable:focus-within .inline-edit-trigger {
  opacity: 1;
}

.inline-edit-form {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  margin-top: 0.25rem;
  width: 100%;
}

.inline-edit-input {
  width: 100%;
}

.inline-edit-actions {
  display: flex;
  gap: 0.4rem;
  justify-content: flex-start;
  align-items: center;
}

.room-card-title-text {
  font-weight: 700;
}

.inline-status-form {
  display: inline-flex;
  flex: 1 1 0;
}

.flash {
  border-radius: 0.75rem;
  border: 1px solid var(--border-strong);
  background: var(--bg-soft);
  padding: 0.65rem 0.85rem;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 0.75rem;
  margin: 0.5rem 0;
}

.flash-success {
  border-color: var(--ok);
  background: rgba(16, 185, 129, 0.12);
  color: #047857;
}

[data-theme="dark"] .flash-success {
  background: rgba(52, 211, 153, 0.18);
  color: #34d399;
}

.flash-danger {
  border-color: var(--bad);
  background: rgba(239, 68, 68, 0.12);
  color: #b91c1c;
}

[data-theme="dark"] .flash-danger {
  background: rgba(239, 68, 68, 0.16);
  color: #fca5a5;
}

.flash-toaster {
  position: fixed;
  inset: auto 0 1rem 0;
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
  align-items: center;
  z-index: 9999;
  pointer-events: none;
}

.flash-toast {
  width: min(520px, calc(100% - 1.5rem));
  margin: 0;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.25);
  background: var(--blue-bg);
  border: 1px solid var(--blue-border);
  color: var(--blue-text);
  pointer-events: auto;
  position: relative;
  overflow: hidden;
  padding: 0.9rem 1rem 1.1rem;
  animation: flashIn 200ms ease-out;
}

.flash-toast.flash-success {
  background: var(--green-bg);
  border-color: var(--green-border);
  color: var(--green-text);
}

.flash-toast.flash-danger {
  background: var(--red-bg);
  border-color: var(--red-border);
  color: var(--red-text);
}

.flash-toast.flash-warning {
  background: var(--orange-bg);
  border-color: var(--orange-border);
  color: var(--orange-text);
}

.flash-toast.flash-info {
  background: var(--cyan-bg);
  border-color: var(--cyan-border);
  color: var(--cyan-text);
}

.flash-toast.flash-neutral {
  background: var(--gray-bg);
  border-color: var(--gray-border);
  color: var(--gray-text);
}

.flash-body {
  display: grid;
  gap: 0.2rem;
}

.flash-kicker {
  font-size: 0.8rem;
  letter-spacing: 0.02em;
  text-transform: uppercase;
  opacity: 0.7;
}

.flash-text {
  font-size: 1rem;
  font-weight: 600;
  line-height: 1.4;
}

.flash-close {
  width: 1.9rem;
  height: 1.9rem;
  max-width: 2rem;
  border-radius: 999px;
  border: 1px solid rgba(255, 255, 255, 0.22);
  background: rgba(255, 255, 255, 0.1);
  color: var(--text-on-accent-light);
  display: inline-flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: background 0.2s ease, border-color 0.2s ease, color 0.2s ease, box-shadow 0.2s ease;
}

.flash-close i,
.flash-close svg {
  color: inherit;
  stroke: currentColor;
}

.flash-close:hover,
.flash-close:focus-visible {
  background: rgba(255, 255, 255, 0.18);
  border-color: rgba(255, 255, 255, 0.35);
  color: #fff;
  outline: none;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.25);
}

@media (max-width: 640px) {
  .flash-toaster {
    inset: auto 0 0.75rem 0;
    padding: 0 0.5rem;
  }

  .flash-toast {
    width: calc(100% - 1rem);
    padding: 0.8rem 0.85rem 1rem;
    border-radius: var(--radius-lg, 14px);
  }

  .flash-text {
    font-size: 0.95rem;
    line-height: 1.35;
  }

  .flash-close {
    width: 1.65rem;
    height: 1.65rem;
  }

  .flash-progress {
    left: 0.75rem;
    right: 0.75rem;
  }
}

.flash-progress {
  position: absolute;
  left: 0.85rem;
  right: 0.85rem;
  bottom: 0.6rem;
  height: 4px;
  border-radius: 999px;
  background: rgba(255, 255, 255, 0.08);
  overflow: hidden;
}

.flash-progress span {
  display: block;
  width: 100%;
  height: 100%;
  background: var(--blue-border);
  animation: flashProgress linear forwards;
  animation-duration: var(--flash-duration, 4500ms);
  transform-origin: left center;
}

.flash-toast.flash-success .flash-progress span { background: var(--green-border); }
.flash-toast.flash-danger .flash-progress span { background: var(--red-border); }
.flash-toast.flash-warning .flash-progress span { background: var(--orange-border); }
.flash-toast.flash-info .flash-progress span { background: var(--cyan-border); }
.flash-toast.flash-neutral .flash-progress span { background: var(--gray-border); }

@keyframes flashProgress {
  from { transform: scaleX(1); opacity: 1; }
  to { transform: scaleX(0); opacity: 0.6; }
}

@keyframes flashIn {
  from {
    transform: translateY(12px);
    opacity: 0;
  }
  to {
    transform: translateY(0);
    opacity: 1;
  }
}

.driver-popover {
  color: var(--text-primary);
  background: var(--bg-elevated);
  border: 1px solid var(--border-subtle);
  box-shadow: 0 16px 50px rgba(0, 0, 0, 0.25);
}

.driver-popover-next-btn,
.driver-popover-prev-btn,
.driver-popover-close-btn {
  border-radius: 10px;
  border: 1px solid var(--border-strong);
  font-weight: 600;
  padding: 0.45rem 0.9rem;
  cursor: pointer;
  transition: transform 120ms ease, box-shadow 120ms ease, background 120ms ease;
}

.driver-popover-next-btn {
  background: var(--accent);
  color: #fff;
  border-color: var(--accent-strong, var(--accent));
  box-shadow: 0 12px 30px rgba(37, 99, 235, 0.25);
}

.driver-popover-prev-btn {
  background: var(--bg-soft);
  color: var(--text-secondary);
}

.driver-popover-close-btn {
  background: transparent;
  border-color: transparent;
  color: var(--text-secondary);
}

.driver-popover-next-btn:hover,
.driver-popover-prev-btn:hover,
.driver-popover-close-btn:hover {
  transform: translateY(-1px);
  box-shadow: 0 10px 24px rgba(0, 0, 0, 0.16);
}

.driver-popover-next-btn:focus-visible,
.driver-popover-prev-btn:focus-visible,
.driver-popover-close-btn:focus-visible {
  outline: 2px solid var(--accent);
  outline-offset: 2px;
}

body.modal-open {
  overflow: hidden;
}

.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(15, 23, 42, 0.38);
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 1rem;
  z-index: 90;
  backdrop-filter: blur(2px);
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.15s ease-out;
}

.modal-overlay[hidden] {
  display: none;
}

.modal-overlay.show {
  opacity: 1;
  pointer-events: auto;
}

.modal-dialog {
  width: min(520px, 100%);
  background: var(--bg-elevated);
  border: 1px solid var(--border-strong);
  border-radius: 0.9rem;
  box-shadow: 0 16px 36px rgba(15, 23, 42, 0.22);
  padding: 0.9rem 1rem 1.1rem;
  transform: translateY(10px);
  opacity: 0;
  transition: opacity 0.15s ease-out, transform 0.15s ease-out;
  max-height: calc(100vh - 3rem);
  overflow-y: auto;
  display: flex;
  flex-direction: column;
}

.modal-overlay.show .modal-dialog {
  opacity: 1;
  transform: translateY(0);
}

.whats-new-body {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.whats-new-media {
  flex: 0 0 auto;
  border-radius: 0.75rem;
  background: var(--bg-soft);
  border: 1px solid var(--border-strong);
  overflow: hidden;
}

.whats-new-text {
  flex: 1 1 auto;
  min-height: 0;
  overflow-y: auto;
  padding-right: 0.25rem;
}

.modal-header {
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  gap: 0.5rem;
}

.modal-title-group {
  display: flex;
  flex-direction: column;
  gap: 0.2rem;
}

.modal-eyebrow {
  text-transform: uppercase;
  letter-spacing: 0.08em;
  font-weight: 700;
  font-size: 0.75rem;
  color: var(--text-secondary);
}

.modal-title {
  margin: 0;
  font-size: 1.1rem;
}

.modal-body {
  flex: 1 1 auto;
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
  margin-top: 0.35rem;
  overflow: hidden;
}

.update-modal .modal-body {
  max-height: 65vh;
  overflow-y: auto;
  padding-right: 0.4rem;
}

.update-modal .whats-new-media {
  flex: 0 0 auto;
}

.modal-text {
  margin: 0;
  color: var(--text-secondary);
  line-height: 1.45;
}

.modal-alert {
  display: inline-flex;
  align-items: center;
  gap: 0.45rem;
  padding: 0.55rem 0.6rem;
  border-radius: 0.7rem;
  border: 1px solid var(--border-strong);
  background: var(--bg-soft);
  font-weight: 700;
  color: var(--text-primary);
}

.modal-alert svg {
  width: 1rem;
  height: 1rem;
}

.modal-alert.danger {
  border-color: var(--danger);
  color: var(--danger);
  background: rgba(220, 38, 38, 0.08);
}

[data-theme="dark"] .modal-alert.danger {
  background: rgba(248, 113, 113, 0.12);
}

.modal-form {
  display: flex;
  flex-direction: column;
  gap: 0.55rem;
}

.modal-label {
  font-weight: 700;
  font-size: 0.95rem;
  color: var(--text-primary);
}

.modal-input {
  width: 100%;
}

.modal-actions {
  display: flex;
  justify-content: flex-end;
  gap: 0.45rem;
  flex-wrap: wrap;
  margin-top: 0.15rem;
}

.modal-actions.sticky {
  position: sticky;
  bottom: 0;
  margin: 0 -1rem -1px;
  padding: 0.75rem 1rem;
  background: #ffffff;
  width: calc(100% + 2rem);
  border-top: 1px solid rgba(0, 0, 0, 0.08);
  box-shadow: inset 0 1px 0 rgba(0, 0, 0, 0.04);
  z-index: 5;
}

.whats-new-text {
  padding-bottom: 3rem;
}

.modal-close {
  border-color: var(--border-subtle);
}

.modal-close svg {
  width: 1.35rem;
  height: 1.35rem;
}

.whats-new-media img {
  display: block;
  width: 100%;
  height: auto;
  object-fit: cover;
}

.whats-new-sections {
  display: flex;
  flex-direction: column;
  gap: 0.85rem;
  max-height: 45vh;
  overflow-y: auto;
  padding-right: 0.25rem;
}

.whats-new-section {
  border-top: 1px solid var(--border-subtle);
  padding-top: 0.75rem;
}

.whats-new-section:first-child {
  border-top: none;
  padding-top: 0.25rem;
}

.whats-new-section-title {
  margin: 0 0 0.25rem;
  font-size: 1rem;
}

.whats-new-items {
  padding-left: 1rem;
}

  .whats-new-items,.whats-new-section-text {
  margin: 0;
  color: var(--text-secondary);
  line-height: 1.5;
  }

.whats-new-content {
  border-top: 1px solid var(--border-subtle);
  padding-top: 0.75rem;
}

.markdown-body {
  color: var(--text-primary);
  line-height: 1.65;
  display: grid;
  gap: 0.75rem;
}

.markdown-body h1,
.markdown-body h2,
.markdown-body h3,
.markdown-body h4,
.markdown-body h5,
.markdown-body h6 {
  margin: 0.3rem 0 0.15rem;
  line-height: 1.25;
}

.markdown-body p {
  margin: 0;
}

.markdown-body ul,
.markdown-body ol {
  margin: 0;
  padding-left: 1.25rem;
  display: grid;
  gap: 0.35rem;
}

.markdown-body code {
  background: color-mix(in srgb, var(--bg-soft) 70%, transparent);
  border: 1px solid var(--border-subtle);
  border-radius: 0.5rem;
  padding: 0.15rem 0.35rem;
  font-size: 0.9em;
}

.markdown-body pre code {
  display: block;
  padding: 0.75rem;
}

.markdown-body blockquote {
  margin: 0;
  padding: 0.6rem 0.8rem;
  border-left: 3px solid var(--accent);
  background: color-mix(in srgb, var(--accent-soft) 16%, transparent);
  border-radius: 0.75rem;
}

.updates-shell {
  max-width: 1020px;
  margin: 1.25rem auto 1.75rem;
  padding: 1.25rem 1.25rem 1.5rem;
  display: grid;
  gap: 1.25rem;
}

.updates-hero {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 1rem;
  padding: 1.2rem 1.25rem;
  border-radius: var(--radius-xl);
  border: 1px solid var(--border-subtle);
  background: color-mix(in srgb, var(--bg-elevated) 92%, var(--bg-soft) 8%);
}

.updates-hero__body {
  display: grid;
  gap: 0.55rem;
}

.updates-hero__title {
  margin: 0;
  font-size: 1.4rem;
}

.updates-hero__meta {
  display: flex;
  align-items: center;
  gap: 0.45rem;
  flex-wrap: wrap;
  color: var(--text-secondary);
}

.updates-hero__text {
  margin: 0;
  color: var(--text-secondary);
  line-height: 1.5;
}

.updates-list {
  display: grid;
  gap: 0.9rem;
}

.updates-hero__media {
  border-radius: var(--radius-lg);
  overflow: hidden;
  border: 1px solid var(--border-subtle);
  background: var(--bg-soft);
}

.updates-hero__media img {
  display: block;
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.updates-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
  gap: 1rem;
  padding: 0.25rem;
}

.updates-shell .panel {
  padding: 1rem 1.1rem;
}

.update-card {
  border: 1px solid var(--border-subtle);
  border-radius: var(--radius-lg);
  background: color-mix(in srgb, var(--bg-elevated) 92%, var(--bg-soft) 8%);
  padding: 1rem;
  display: grid;
  gap: 0.6rem;
  position: relative;
}

.update-card--anchor,
.update-card--modal {
  text-decoration: none;
  color: inherit;
  transition: border-color 0.18s ease;
  display: grid;
  width: 100%;
  height: 100%;
  cursor: pointer;
}

.update-card--anchor:hover,
.update-card--anchor:focus-visible,
.update-card--modal:hover,
.update-card--modal:focus-visible {
  border-color: var(--accent);
  outline: none;
}

.update-card__cover {
  border-radius: var(--radius-md);
  overflow: hidden;
  border: 1px solid var(--border-subtle);
  background: var(--bg-soft);
}

.update-card__cover img {
  display: block;
  width: 100%;
  height: 170px;
  object-fit: cover;
  background: var(--bg-soft);
}

.update-card__meta {
  display: flex;
  align-items: center;
  gap: 0.45rem;
  color: var(--text-secondary);
  font-size: 0.9rem;
  flex-wrap: wrap;
}

.update-card__title {
  margin: 0;
  font-size: 1.02rem;
}

.update-card__excerpt {
  margin: 0;
  color: var(--text-secondary);
  line-height: 1.5;
}

.update-card__footer {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 0.5rem;
  color: var(--text-secondary);
}

.update-card__cta {
  font-weight: 600;
}

.update-card__more {
  display: inline-flex;
  align-items: center;
  gap: 0.35rem;
  color: var(--text-secondary);
  font-size: 0.9rem;
}

.update-article {
  border: 1px solid var(--border-subtle);
  border-radius: var(--radius-xl);
  background: color-mix(in srgb, var(--bg-elevated) 92%, var(--bg-soft) 8%);
  padding: 1.3rem 1.25rem;
  display: grid;
  gap: 0.8rem;
}

.update-back {
  display: inline-flex;
  align-items: center;
  gap: 0.35rem;
  color: var(--text-secondary);
  text-decoration: none;
}

.update-article__head {
  display: grid;
  gap: 0.35rem;
}

.update-article__title {
  margin: 0;
  font-size: 1.5rem;
}

.update-article__meta {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  color: var(--text-secondary);
}

.update-article__cover {
  border-radius: var(--radius-lg);
  overflow: hidden;
  border: 1px solid var(--border-subtle);
  background: var(--bg-soft);
}

.update-article__cover img {
  display: block;
  width: 100%;
  height: 320px;
  object-fit: cover;
}

.update-article__body {
  border-top: 1px solid var(--border-subtle);
  padding-top: 0.75rem;
}

.pagination {
  margin-top: 0.5rem;
}
  
  /* Welcome modal readability */
  [data-welcome-modal] .modal-dialog {
  border: 1px solid var(--border-strong);
  box-shadow: 0 16px 32px rgba(15, 23, 42, 0.22);
}

[data-welcome-modal] .modal-text {
  color: var(--text-primary);
  font-size: 1rem;
  line-height: 1.65;
  letter-spacing: 0.01em;
  font-weight: 500;
}

[data-welcome-modal] .modal-text p {
  margin: 0.15rem 0 0.45rem;
}

[data-welcome-modal] .modal-text a {
  color: #6b8bff;
  font-weight: 600;
}

[data-welcome-modal] .modal-text a:hover {
  color: #4a6fe8;
}

[data-welcome-modal] .text-beta {
  color: #6b8bff;
  font-weight: 600;
}

.legal-page .panel-body {
  max-width: 1080px;
  margin: 0 auto;
}

.legal-content {
  max-width: 800px;
  margin: 0 auto;
  display: grid;
  gap: 1rem;
  line-height: 1.6;
}

.legal-meta {
  color: var(--muted);
  font-size: 0.9rem;
}

.page-legal .app-mobile-tabs {
  display: none !important;
}

.legal-page .legal-back-btn {
  width: auto;
  min-width: 0;
}

*::-webkit-scrollbar {
  width: 10px;
  height: 10px;
  background: transparent;
}

*::-webkit-scrollbar-track {
  background: transparent;
  border-radius: 999px;
}

*::-webkit-scrollbar-thumb {
  background: var(--scroll-thumb);
  border-radius: 999px;
  border: 2px solid transparent;
  background-clip: padding-box;
}

*::-webkit-scrollbar-button {
  display: none;
}

*::-webkit-scrollbar-button:single-button {
  display: none;
}

*::-webkit-scrollbar-button:vertical:decrement,
*::-webkit-scrollbar-button:vertical:increment,
*::-webkit-scrollbar-button:horizontal:decrement,
*::-webkit-scrollbar-button:horizontal:increment {
  width: 0;
  height: 0;
  display: none;
}

*::-webkit-scrollbar-thumb:hover {
  background: color-mix(in srgb, var(--scroll-thumb) 85%, #ffffff 15%);
}

  .page-join .app-footer,
  .error-page-shell .app-footer {
    display: flex !important;
  }

  .page-join .join-visited-panel {
    margin-top: 2rem;
  }
  .page-join .visited-rooms-grid {
    display: grid;
    grid-template-columns: repeat(3, minmax(0, 1fr));
    gap: 1rem;
    padding: 0.5rem;
    justify-items: start;
    grid-auto-rows: 1fr;
  }
  .page-join .visited-room-card {
    width: 100%;
    min-height: 200px;
    max-height: 270px;
    display: flex;
    flex-direction: column;
    box-sizing: border-box;
    overflow: hidden;
    margin: 0 auto;
  }
  .page-join .visited-room-title {
    font-size: 1.05rem;
    font-weight: 700;
    margin-bottom: 0.05rem;
  }
  .page-join .visited-room-description {
    color: var(--text-secondary);
    line-height: 1.5;
    margin: 0.35rem 0 0.75rem;
    display: -webkit-box;
    -webkit-line-clamp: 4;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  .page-join .visited-room-actions {
    margin-top: auto;
  }

@media (hover: none) {
  .message-actions {
    opacity: 1;
    pointer-events: auto;
  }
}

@media (max-width: 640px) {
  .reaction-menu {
    transform: none;
    max-width: 95vw;
    padding: 0.55rem 0.65rem;
  }
  .app-footer {
    flex-direction: column;
    align-items: flex-start;
  }
  .error-panel {
    padding: 1.1rem 1.1rem 1.3rem;
  }
  
  .error-title {
    font-size: 1.6rem;
  }
  
  .error-actions {
    flex-direction: column;
    align-items: stretch;
  }
  
  .error-actions .btn {
    width: 100%;
    justify-content: center;
  }
}

@media (max-width: 768px) {
  .legal-page .legal-back-btn {
    padding: 0.4rem 0.65rem;
    font-size: 0.78rem;
  }
  :root {
    --mobile-tab-bar-height: 76px;
    --mobile-safe-bottom: env(safe-area-inset-bottom, 0px);
    --mobile-header-height: 112px;
  }
  
  html,
        body {
    overflow-x: hidden;
    overflow-y: auto;
    background: var(--bg);
  }
  
  html,
        body,body.app,
        .app {
    min-height: var(--app-viewport-height);
    height: auto;
    width: 100%;
    max-width: 100%;
  }
  
  body {
    display: flex;
    width: 100%;
  }
  
  .app-shell {
    min-height: var(--app-viewport-height);
    height: auto;
  }
  
  .app-shell,.app {
    display: flex;
    flex-direction: column;
    width: 100%;
    max-width: 100%;
  }
  
  .app {
    background: var(--bg);
  }
  
  .app,main {
    min-height: 0;
  }
  
  main {
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;
    gap: 0.65rem;
    padding: 0.65rem 0.85rem calc(var(--mobile-tab-bar-height) + var(--mobile-safe-bottom) + 0.75rem);
    overflow: hidden;
    width: 100%;
    max-width: 100%;
  }
  
  body.page-join main,
    body.page-legal main,
    body.error-page-shell main {
    overflow: auto;
    min-height: auto;
    height: auto;
    max-height: none;
  }
  
  body.page-join main,
    body.page-legal main {
    padding-bottom: 0.85rem;
  }
  
  .room-page,.layout {
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;
    gap: 0.65rem;
    height: auto;
    overflow: hidden;
  }
  
  .room-page {
    padding-bottom: calc(var(--mobile-tab-bar-height) + var(--mobile-safe-bottom, 0px));
  }
  
  .layout {
    padding-bottom: 0;
  }
  
  .panel {
    border-radius: var(--radius-xl);
    border: 1px solid var(--border-subtle);
    background: var(--bg-elevated);
    box-shadow: 0 10px 22px rgba(0, 0, 0, 0.1);
    min-height: 0;
  }
  
  .panel.chat-panel,
        .panel.student-panel,
        .panel.queue-panel {
    box-shadow: none;
    border-radius: var(--radius-lg);
    border: 1px solid var(--border-subtle);
    background: #f8fafc;
    min-height: 320px;
  }
  
  .panel-header {
    border-top-left-radius: var(--radius-lg);
    border-top-right-radius: var(--radius-lg);
    border-bottom-left-radius: var(--radius-lg);
    border-bottom-right-radius: var(--radius-lg);
  }
  
  .panel.chat-panel .panel-header,
        .panel.student-panel .panel-header {
    padding: var(--panel-header-padding);
    border-bottom: 1px solid var(--border-subtle);
  }
  
  .panel.chat-panel .panel-body,
        .panel.student-panel .panel-body {
    padding: 0.25rem 0.65rem 0.5rem;
  }
  
  .chat-panel {
    padding: 0.65rem 0.75rem calc(var(--mobile-tab-bar-height) + var(--mobile-safe-bottom, 0px));
    gap: 0.2rem;
  }

  .chat-panel,.chat-panel .panel-body {
    flex: 1;
    min-height: 0;
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  .chat-panel .panel-body {
    padding-top: 0.1rem;
  }

  .chat-messages {
    padding: 0.4rem 0.2rem 1rem;
    gap: 0.35rem;
    flex: 1 1 auto;
    min-height: 0;
    height: auto;
    overflow-y: auto;
  }
  
  .message-body {
    max-width: 82%;
  }
  
  .chat-textarea {
    min-height: 3.8rem;
    padding: 0.55rem 0.65rem;
    max-height: 30vh;
  }
  
  .send-btn {
    min-width: 3rem;
    min-height: 3rem;
    width: 3rem;
    height: 3rem;
    border-radius: 0.75rem;
  }
  
  .student-panel {
    padding: 0;
  }
  
  .student-panel .panel-body {
    padding-top: 0.2rem;
  }
  
  .questions-list {
    padding: var(--list-rhythm);
  }
  
  .question-item {
    padding: 0.5rem 0.55rem;
  }
  
  .question-header {
    align-items: flex-start;
  }
  
  .question-header,.rating-options {
    gap: 0.35rem;
  }
  
  .app-header {
    position: sticky;
    top: 0;
    z-index: 40;
    border: none;
    background: var(--bg-elevated);
    box-shadow: 0 8px 18px rgba(0, 0, 0, 0.08);
    padding: 0.9rem 1rem 0.7rem;
    flex-direction: column;
    align-items: stretch;
    gap: 0.65rem;
  }
  
  .app-header-left {
    width: 100%;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 0.6rem;
  }
  
  .app-title {
    font-size: 1.05rem;
    letter-spacing: -0.01em;
  }
  
  .app-title .badge {
    display: inline-flex;
    align-items: center;
    gap: 0.2rem;
    padding: 0.18rem 0.55rem;
    border: none;
    background: var(--bg-soft);
    color: var(--accent-strong);
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.06);
  }
  
  .app-controls {
    width: 100%;
    display: grid;
    grid-template-columns: 1fr auto;
    gap: 0.5rem 0.35rem;
    align-items: center;
  }
  
  .app-controls .account-controls,
        .app-controls #themeToggle {
    display: none;
  }
  
  .room-info {
    grid-column: 1 / -1;
    width: 100%;
    padding: 0.45rem 0.65rem;
    border-radius: 0.8rem;
    background: var(--bg-elevated);
    border: 1px solid var(--border-subtle);
    box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.4);
    text-align: left;
    font-size: 0.88rem;
  }
  
  .btn-group {
    width: 100%;
    justify-content: space-between;
  }
  
  .btn,
        .icon-btn {
    height: 42px;
    border-radius: 0.9rem;
  }
  
  .mobile-menu-btn {
    display: inline-flex;
    background: rgba(255, 255, 255, 0.9);
    color: var(--text-primary);
    border-color: var(--border-subtle);
  }
  
  .account-controls {
    justify-content: flex-end;
  }
  
  .account-btn {
    width: auto;
  }
  
  .mobile-tabs {
    position: fixed;
    left: 0;
    right: 0;
    bottom: 0;
    display: flex;
    flex-wrap: nowrap;
    gap: 0.35rem;
    padding: 0.5rem 0.65rem calc(0.5rem + var(--mobile-safe-bottom, 0px));
    border-top: 1px solid var(--border-subtle);
    box-shadow: 0 -8px 18px rgba(0, 0, 0, 0.08);
    z-index: 45;
    height: calc(var(--mobile-tab-bar-height) + var(--mobile-safe-bottom, 0px));
    min-height: calc(var(--mobile-tab-bar-height) + var(--mobile-safe-bottom, 0px));
    transform: translateZ(0);
    backface-visibility: hidden;
    will-change: transform;
  }
  
  .mobile-tabs,.mobile-tab-btn {
    background: var(--bg-elevated);
  }
  
  .mobile-tab-btn {
    flex: 1 1 0;
    min-width: 0;
    border-radius: 0.95rem;
    border: 1px solid var(--border-subtle);
    padding: 0.55rem 0.45rem;
    font-size: 0.84rem;
    font-weight: 700;
    color: var(--text-secondary);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.3rem;
    white-space: nowrap;
    cursor: pointer;
    transition: all 0.15s ease-out;
    position: relative;
  }
  
  .role-student .mobile-tab-btn[data-tab-target="queue"],
        .role-teacher .mobile-tab-btn[data-tab-target="questions"] {
    display: none;
  }
  
  .mobile-tab-btn.active {
    color: var(--text-primary);
    border-color: var(--accent);
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.08);
    background: var(--accent-soft);
  }
  
  .mobile-tab-btn .mobile-badge {
    position: absolute;
    top: -4px;
    right: 10px;
    min-width: 18px;
    height: 18px;
    padding: 0 6px;
    border-radius: 999px;
    background: var(--notify);
    color: #fff;
    font-size: 0.65rem;
    font-weight: 700;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
  }
  
  .mobile-panel {
    display: none;
    min-height: 0;
  }
  
  .chat-panel .panel-header {
    position: sticky;
    top: 0;
    z-index: 2;
    padding: 0.3rem 0.25rem 0.4rem;
    background: inherit;
  }
  
  .chat-input-row {
    align-items: center;
  }
  
  .chat-send-options {
    padding-inline: 0.05rem;
    justify-content: flex-start;
  }
  
  .panel:not(.chat-panel) {
    padding: 0.55rem 0.7rem 0.6rem;
  }
  
  .panel-body,
        .panel-footer {
    min-height: 0;
  }
  
  .app-footer {
    display: none !important;
  }
  
  .message .message-actions {
    opacity: 1;
    pointer-events: auto;
  }
  
  .mobile-menu-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.35);
    display: none;
    align-items: flex-end;
    justify-content: center;
    z-index: 50;
    padding: 0.5rem;
  }
  
  .mobile-menu-overlay.show {
    display: flex;
  }
  
  .mobile-menu-card {
    width: 100%;
    max-width: 520px;
    background: var(--bg-elevated);
    border-radius: 1.15rem;
    border: 1px solid var(--border-strong);
    padding: 1.1rem 1.25rem 1.4rem;
    display: grid;
    gap: 1.25rem;
    box-shadow: 0 12px 26px rgba(15, 23, 42, 0.12);
    backdrop-filter: blur(8px);
  }
  
  .mobile-menu-handle {
    width: 56px;
    height: 6px;
    border-radius: 999px;
    background: var(--border-strong);
    opacity: 0.85;
    margin: 0 auto 0.2rem;
  }
  
  .mobile-menu-row {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 0.85rem;
    padding: 0.85rem 0.9rem;
    border: 1px solid var(--border-subtle);
    border-radius: 1rem;
    background: var(--bg-elevated);
  }
  
  .mobile-menu-actions {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
    gap: 0.65rem;
  }
  
  .mobile-menu-row .btn,
        .mobile-menu-row .icon-btn {
    flex: 1 1 auto;
    justify-content: center;
    padding: 0.85rem 0.8rem;
    border-radius: 1rem;
    border: 1px solid var(--border-subtle);
    background: #fff;
    color: var(--text-primary);
    font-weight: 700;
    box-shadow: 0 6px 18px rgba(15, 23, 42, 0.08);
  }
  
  .mobile-menu-row .btn-primary {
    color: #f9fafb;
    background: var(--accent);
    border-color: var(--accent);
    box-shadow: none;
  }
  
  .mobile-menu-row .footer-lang {
    width: 100%;
    padding: 0.75rem 0.8rem;
    border-radius: 1rem;
    font-size: 0.9rem;
    border-color: var(--border-strong);
  }
  
  .mobile-menu-row .footer-lang.active {
    border-color: var(--accent);
    background: var(--accent-soft);
    color: var(--accent-strong);
  }
  
  .mobile-menu-links {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 0.6rem;
    width: 100%;
  }
  
  .mobile-menu-links a {
    display: inline-flex;
    align-items: center;
    gap: 0.35rem;
    justify-content: center;
    padding: 0.75rem;
    border-radius: 1rem;
    border: 1px solid var(--border-strong);
    background: var(--bg-elevated);
    color: var(--text-primary);
    font-weight: 600;
    text-decoration: none;
    box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.35);
    transition: transform 0.12s ease-out, box-shadow 0.12s ease-out, border-color 0.12s ease-out;
  }
  
  .mobile-menu-links a:hover {
    color: var(--accent-strong);
    border-color: var(--accent);
    background: var(--accent-soft);
    transform: translateY(-2px);
    box-shadow: 0 12px 24px rgba(15, 23, 42, 0.12);
  }
  
  .room-header .panel-header {
    grid-template-columns: 1fr;
    align-items: stretch;
    gap: 0.65rem;
    position: relative;
  }
  
  .room-header .panel-actions {
    justify-content: stretch;
    flex-wrap: wrap;
    gap: 0.65rem;
    width: 100%;
  }
  
  .room-header .panel-actions button {
    flex: 1 1 140px;
    width: 100%;
  }
  
  .room-status {
    position: absolute;
    top: 0.55rem;
    right: 0.75rem;
  }
  
  body[data-theme="dark"],[data-theme="dark"] .app {
    background: var(--bg);
  }
  
  [data-theme="dark"] .app-header {
    background: var(--bg-elevated);
    box-shadow: 0 8px 18px rgba(0, 0, 0, 0.24);
  }
  
  [data-theme="dark"] .mobile-tabs {
    box-shadow: 0 -8px 18px rgba(0, 0, 0, 0.24);
  }
  
  [data-theme="dark"] .mobile-tabs,[data-theme="dark"] .panel {
    background: var(--bg-elevated);
    border-color: var(--border-strong);
  }
  
  [data-theme="dark"] .panel {
    box-shadow: 0 10px 22px rgba(0, 0, 0, 0.26);
  }
  
  [data-theme="dark"] .mobile-tab-btn {
    background: var(--bg-elevated);
    border-color: var(--border-strong);
    color: #cbd5f5;
  }
  
  [data-theme="dark"] .mobile-tab-btn.active {
    background: var(--btn-blue-bg);
    border-color: var(--btn-blue-border);
    color: #e5e7eb;
    box-shadow: none;
  }
  
  [data-theme="dark"] .room-info {
    color: #cbd5f5;
  }
  
  [data-theme="dark"] .room-info,[data-theme="dark"] .mobile-menu-card {
    background: var(--bg-elevated);
    border-color: var(--border-strong);
  }
  
  [data-theme="dark"] .mobile-menu-handle {
    background: var(--border-strong);
  }
  
  [data-theme="dark"] .mobile-menu-overlay {
    background: rgba(0, 0, 0, 0.4);
  }
  
  [data-theme="dark"] .mobile-menu-row .btn.btn-ghost,
        [data-theme="dark"] .mobile-menu-row .icon-btn {
    background: var(--bg-elevated);
    border-color: var(--border-strong);
    color: #e5e7eb;
  }
  
  [data-theme="dark"] .mobile-menu-row .footer-lang {
    background: rgba(15, 23, 42, 0.9);
    color: #e5e7eb;
    border-color: var(--border-strong);
  }
  
  [data-theme="dark"] .mobile-menu-row .footer-lang.active {
    border-color: var(--accent);
    background: rgba(255, 255, 255, 0.08);
    color: #e5e7eb;
  }
  
  [data-theme="dark"] .mobile-menu-links a {
    background: rgba(15, 23, 42, 0.92);
    border-color: var(--border-strong);
    color: #cbd5f5;
  }
  
  [data-theme="dark"] .mobile-menu-links a:hover {
    color: #93c5fd;
    border-color: var(--accent);
    background: rgba(255, 255, 255, 0.08);
  }
  
  .layout,
    .layout.teacher,.layout .panel,
    .layout.teacher .panel {
    flex: 1 1 auto;
    min-height: 0;
    height: auto;
    max-height: none;
  }
  
.mobile-panel.mobile-active {
  display: flex;
  flex-direction: column;
  flex: 1 1 auto;
  min-height: 0;
  height: calc(var(--app-viewport-height, 100vh) - var(--mobile-tab-bar-height, 104px));
  max-height: calc(var(--app-viewport-height, 100vh) - var(--mobile-tab-bar-height, 104px));
  overflow: hidden;
}

  /* Force chat to scroll inside the panel on mobile */
  .chat-panel.mobile-panel.mobile-active {
    height: calc(var(--app-viewport-height, 100vh) - var(--mobile-tab-bar-height, 104px));
    max-height: calc(var(--app-viewport-height, 100vh) - var(--mobile-tab-bar-height, 104px));
    overflow: hidden;
    display: flex;
    flex-direction: column;
  }

.chat-panel.mobile-panel.mobile-active .panel-body {
  flex: 1 1 auto;
  min-height: 0;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  padding-bottom: calc(var(--mobile-tab-bar-height, 104px) - 16px);
}

.mobile-panel.mobile-active .panel-body {
  flex: 1 1 auto;
  min-height: 0;
  padding-bottom: calc(var(--mobile-tab-bar-height, 104px) - 12px);
}

  .chat-panel.mobile-panel.mobile-active .chat-messages {
    flex: 1 1 auto;
    min-height: 0;
    overflow-y: auto;
  }
  
  .app-footer {
    display: none;
  }
  
  .page-join .app-footer,
    .error-page-shell .app-footer {
    display: flex;
  }
  
  .panel-footer {
    border-radius: 0.75rem;
  }
  
  html,
    body,
    .app,
    .app-shell {
    height: auto;
  }

  body.page-join,
    body.page-legal,
    body.error-page-shell {
    overflow: auto;
  }
  
  body.page-join .app,
    body.page-legal .app,
    body.error-page-shell .app,
    body.error-page-shell .app-shell {
    height: auto;
    min-height: 100vh;
    overflow: visible;
  }

  body.page-join .app-shell,
    body.page-legal .app-shell {
    height: auto;
    min-height: 100vh;
    overflow-x: hidden;
    overflow-y: auto;
  }

  @media (max-width: 640px) {
    .page-join .visited-rooms-grid {
      grid-template-columns: 1fr;
    }
  }
  
  .app-mobile-tabs {
    position: fixed;
    left: 0;
    right: 0;
    bottom: 0;
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(110px, 1fr));
    gap: 0.35rem;
    row-gap: 0.4rem;
    padding: 0.5rem 0.75rem calc(0.5rem + var(--mobile-safe-bottom, 0px));
    background: var(--bg-elevated);
    border-top: 1px solid var(--border-subtle);
    box-shadow: 0 -8px 18px rgba(0, 0, 0, 0.08);
    z-index: 44;
    min-height: calc(var(--mobile-tab-bar-height, 104px) + var(--mobile-safe-bottom, 0px));
    transform: translateZ(0);
    backface-visibility: hidden;
    will-change: transform;
  }
  
  .app-mobile-tabs .mobile-tab-btn {
    width: 100%;
  }
  
  .dashboard-hero {
    gap: 0.65rem;
    padding: 1rem 0.9rem;
  }
  
  .dashboard-hero__actions,
    .dashboard-hero__stats {
    flex-direction: column;
    gap: 0.6rem;
    align-items: stretch;
  }
  
  .dashboard-hero__actions .btn {
    width: 100%;
    justify-content: center;
  }
  
  .rooms-grid {
    grid-template-columns: 1fr;
  }
  
  .rooms-panel .panel-body {
    padding: 0.9rem 0.95rem 1rem;
  }
  
  .room-card-actions {
    flex-direction: column;
    align-items: stretch;
  }
  
  .room-card-actions .btn {
    width: 100%;
  }
  
  .profile-container {
    padding: 1rem 0.85rem 1.2rem;
    gap: 0.85rem;
  }
  
  .profile-container .panel-header,
    .profile-container .panel-body {
    padding-inline: 0.9rem;
  }
  
  .profile-container .panel {
    border-radius: 0.85rem;
  }
  
  .profile-container .panel-body form {
    gap: 0.75rem;
  }
  .chat-panel {
    max-height: none;
  }
  
.room-page {
  padding-bottom: calc(var(--mobile-tab-bar-height, 104px) + var(--mobile-safe-bottom, 0px));
  min-height: var(--app-viewport-height, 100vh);
  height: auto;
}
  
  .room-page .chat-panel {
    padding-bottom: 0.75rem;
  }

  .message-actions {
    opacity: 1;
    pointer-events: auto;
  }

  .chat-input {
    z-index: 36;
  }
  .mobile-menu-footer {
    padding: 0.6rem 0.25rem 0.35rem;
    gap: 0.7rem;
  }
  
  .mobile-menu-footer-links,
    .mobile-menu-footer-lang {
    gap: 0.55rem;
  }
  .panel.student-panel,
  .panel.queue-panel,
  .panel.chat-panel {
    display: flex;
    flex-direction: column;
    overflow: hidden;
    flex: 1 1 auto;
    min-height: 320px;
  }

  .student-panel .panel-body,
  .queue-panel .panel-body,
  .chat-panel .panel-body {
    flex: 1;
    min-height: 0;
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  .questions-list,
  .queue-list,
  .chat-messages {
    flex: 1;
    min-height: 0;
    overflow-y: auto;
    padding-right: 0.25rem;
  }
  .app-footer {
    padding: 0.8rem 1rem 0.95rem;
    font-size: 0.82rem;
    gap: 0.55rem;
    background: var(--bg-elevated);
  }
  
  .footer-grid {
    grid-template-columns: 1fr;
    gap: 0.45rem;
    text-align: left;
  }
  
  .footer-column {
    justify-items: start;
    gap: 0.25rem;
  }
  
  .footer-heading {
    font-size: 0.9rem;
    letter-spacing: 0.005em;
  }
  
  .footer-links-list {
    gap: 0.2rem;
    font-size: 0.82rem;
  }
  
  .footer-links-list a {
    line-height: 1.3;
    font-weight: 300;
  }
  
  .footer-muted {
    font-size: 0.8rem;
    text-align: left;
  }
  
  .page-join .app-footer,
    .error-page-shell .app-footer {
    padding: 0.65rem 0.85rem;
    font-size: 0.78rem;
    gap: 0.55rem;
  }
  
  .page-join .footer-grid,
    .error-page-shell .footer-grid {
    gap: 0.5rem;
  }
}

@media (max-width: 560px) {
  .reply-preview {
    padding: 0.6rem 0.65rem;
    row-gap: 0.4rem;
  }
  
  .reply-preview .icon-btn {
    width: 1.9rem;
    height: 1.9rem;
  }
  
  .reply-preview-label {
    flex-wrap: wrap;
  }
  
  .reply-preview-text {
    font-size: 0.83rem;
  }
}

@media (max-width: 520px) {
  .qr-card {
    max-width: 100%;
    padding: 1.1rem 1.15rem;
  }
  
  .layout,
        .layout.teacher,
        #layoutRoot {
    padding-bottom: 0 !important;
  }
  
  .room-page {
    padding-bottom: calc(var(--mobile-tab-bar-height, 104px) + var(--mobile-safe-bottom, 0px)) !important;
    min-height: var(--app-viewport-height, 100vh);
    height: auto;
  }
  
  .qr-body {
    flex-direction: column;
    align-items: flex-start;
  }
  
  .qr-box {
    width: min(260px, 90vw);
  }
  
  .app-header {
    padding: 0.8rem 0.85rem 0.6rem;
    gap: 0.5rem;
  }
  
  .app-controls {
    grid-template-columns: 1fr;
    align-items: stretch;
  }
  
  .room-info {
    order: -1;
  }
  
  .btn,
        .icon-btn {
    width: 100%;
  }
  
  .mobile-tabs {
    grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
  }
  
  .chat-panel {
    padding: 0.6rem 0.7rem calc(var(--mobile-tab-bar-height, 104px));
  }
}

@media (max-width: 1024px) {
  .layout {
    height: calc(var(--app-viewport-height, 100vh) - 200px);
    min-height: calc(var(--app-viewport-height, 100vh) - 100px);
    max-height: none;
    grid-auto-rows: minmax(0, 1fr);
  }
  
  .layout,.layout.teacher {
    grid-template-columns: 1.7fr 1.3fr;
    padding-bottom: calc(var(--mobile-tab-bar-height, 104px) + var(--mobile-safe-bottom, 0px));
  }

  .room-page .layout {
    padding-bottom: 0;
  }
  
  .layout.teacher {
    grid-template-rows: minmax(0, 1fr);
  }
}

@media (max-width: 768px) {
  html,
    body {
    height: var(--app-viewport-height);
    min-height: var(--app-viewport-height);
  }
  
  main {
    flex: 1;
    padding: 0.5rem 0.75rem 0.75rem;
  }
  
  .panel {
    max-height: none;
  }
  
  .app-header {
    padding: 0.6rem 0.75rem;
    flex-direction: column;
    align-items: flex-start;
    gap: 0.4rem;
  }
  
  .app-header-left {
    width: 100%;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 0.5rem;
  }
  
  .app-title {
    font-size: 0.95rem;
  }
  
  .app-controls {
    width: 100%;
    justify-content: space-between;
    flex-wrap: wrap;
    row-gap: 0.3rem;
  }
  
  .room-info {
    text-align: left;
  }
  
  .chat-panel {
    display: flex;
    flex-direction: column;
    border-radius: 1rem;
    padding: 0.6rem 0.75rem 0;
  }
  
  .chat-panel .panel-header {
    padding: var(--panel-header-padding);
    padding-bottom: calc(var(--panel-header-padding) - 0.15rem);
  }
  
  .chat-panel .panel-subtitle {
    display: none;
  }
  
  .chat-panel .panel-body,.chat-messages {
    flex: 1;
    min-height: 0;
  }
  
  .chat-messages {
    padding: 0.4rem 0.2rem 1rem;
    gap: 0.35rem;
    height: auto;
  }

.chat-messages,.chat-panel.mobile-panel.mobile-active .chat-messages {
  flex: 1 1 auto;
  min-height: 0;
  overflow-y: auto;
  overflow-x: hidden;
}

.chat-pane[data-chat-panel="replies"] {
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

  /* Teacher view: ensure panels clear bottom tabs on mobile */
  .layout.teacher .panel {
    max-height: none;
    min-height: 0;
    flex: 1 1 auto;
  }

  .layout.teacher .panel .panel-body {
    flex: 1 1 auto;
    min-height: 0;
    overflow: auto;
    padding-bottom: calc(var(--mobile-tab-bar-height, 104px) - 12px);
  }
  
  .chat-input-row {
    grid-template-columns: 1fr auto;
    gap: 0.35rem;
  }
  
  .chat-textarea {
    min-height: 2.6rem;
    padding: 0.5rem 0.75rem;
  }
  
  .send-btn {
    height: 3rem;
    min-width: 3rem;
    padding: 0 0.75rem;
    border-radius: 0.75rem;
    width: 3rem;
    min-height: 3rem;
  }
  
  .send-btn svg {
    width: 1.1rem;
    height: 1.1rem;
  }
  
  .message-body {
    max-width: 85%;
  }
  
  .panel:not(.chat-panel) {
    padding: 0.6rem 0.75rem 0.65rem;
    border-radius: var(--radius-lg);
  }
  
  .panel-header {
    padding: var(--panel-header-padding);
  }
  .layout,
    .layout.teacher {
    display: flex;
    flex-direction: column;
    flex: 1 1 0;
    min-height: calc(var(--app-viewport-height, 100vh) - var(--mobile-tab-bar-height, 104px));
    height: auto;
    max-height: none;
  padding-bottom: calc(var(--mobile-tab-bar-height, 104px) + var(--mobile-safe-bottom, 0px));
  gap: 0.75rem;
  }

  .room-page .layout {
    padding-bottom: 0;
  }
}

.replies-layout {
  display: grid;
  grid-template-columns: 340px minmax(0, 1fr);
  gap: 0;
  border: 1px solid var(--border-subtle);
  border-radius: var(--radius-xl);
  background: color-mix(in srgb, var(--bg-elevated) 92%, var(--bg-soft) 8%);
  overflow: hidden;
  flex: 1 1 auto;
  min-height: 0;
  height: 100%;
  overflow: hidden;
  position: relative;
}

.replies-layout.is-collapsed {
  grid-template-columns: 1fr;
  border-radius: var(--radius-xl);
}

.replies-layout.is-collapsed .replies-sidebar {
  border-right: none;
}

.replies-layout.is-collapsed .replies-detail {
  border-left: none;
}

.replies-sidebar {
  background: color-mix(in srgb, var(--bg-elevated) 90%, var(--bg-soft) 10%);
  border: none;
  border-right: 1px solid var(--border-subtle);
  border-radius: 0;
  padding: 0.8rem 0.9rem;
  display: flex;
  flex-direction: column;
  gap: 0.6rem;
  overflow: hidden;
  min-height: 0;
  height: 100%;
}

.replies-sidebar-head .panel-title {
  font-size: 1rem;
}

.reply-inbox {
  list-style: none;
  margin: 0;
  padding: 0.1rem;
  display: grid;
  gap: 0.45rem;
  overflow-y: auto;
  min-height: 0;
  align-content: start;
  flex: 1 1 auto;
}

.reply-inbox-item {
  border: 1px solid var(--border-subtle);
  border-radius: var(--radius-lg);
  padding: 0.7rem 0.85rem;
  background: color-mix(in srgb, var(--bg-elevated) 80%, var(--bg-soft) 20%);
  display: grid;
  gap: 0.3rem;
  align-content: start;
  cursor: pointer;
  transition: border-color 0.18s ease, box-shadow 0.18s ease, background 0.18s ease;
  box-shadow: none;
  max-height: none;
  overflow: visible;
}

.reply-inbox-item:hover {
  border-color: var(--accent);
  background: color-mix(in srgb, var(--accent-soft) 55%, var(--bg-elevated));
  color: var(--text-primary);
}

.reply-inbox-item:focus-visible {
  outline: none;
  border-color: var(--accent);
  background: color-mix(in srgb, var(--bg-elevated) 72%, var(--bg-soft) 28%);
}

.reply-inbox-item.is-active {
  border-color: var(--accent);
  background: color-mix(in srgb, var(--bg-elevated) 68%, var(--bg-soft) 32%);
}

.reply-inbox-item.has-new {
  border-color: var(--accent);
  background: color-mix(in srgb, var(--bg-elevated) 64%, var(--bg-soft) 36%);
}

.reply-inbox-top {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 0.5rem;
  flex-wrap: wrap;
}

.reply-inbox-author {
  font-weight: 700;
  color: var(--text-primary);
}

.reply-inbox-meta-row {
  display: flex;
  align-items: center;
  gap: 0.35rem;
  color: var(--text-secondary);
  font-size: 0.84rem;
  flex-wrap: wrap;
}

.reply-inbox-text {
  color: var(--text-primary);
  line-height: 1.45;
  margin: 0.15rem 0 0.25rem;
}

.reply-inbox-meta {
  display: flex;
  align-items: center;
  gap: 0.4rem;
  color: var(--text-secondary);
  font-size: 0.84rem;
}

.reply-inbox-meta-label {
  text-transform: uppercase;
  letter-spacing: 0.04em;
  font-weight: 600;
  font-size: 0.72rem;
}

.reply-inbox-new {
  width: 10px;
  height: 10px;
  border-radius: 999px;
  background: var(--accent-strong);
}

.reply-inbox-item:not(.has-new) .reply-inbox-new {
  display: none;
}

.reply-inbox-empty {
  padding: 1rem;
  text-align: center;
  color: var(--text-secondary);
  border: 1px dashed var(--border-subtle);
  border-radius: var(--radius-lg);
}

.replies-detail {
  border: none;
  border-left: 1px solid var(--border-subtle);
  border-radius: 0;
  background: color-mix(in srgb, var(--bg-elevated) 88%, var(--bg-soft) 12%);
  padding: 1rem 1.1rem;
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
  min-height: 0;
  height: 100%;
  overflow: hidden;
}

.replies-detail[hidden] {
  display: none;
}

.reply-detail-empty {
  border: 1px dashed var(--border-subtle);
  border-radius: var(--radius-lg);
  padding: 1rem;
  display: flex;
  align-items: center;
  gap: 0.75rem;
  color: var(--text-secondary);
}

.reply-detail-illustration {
  font-size: 1.8rem;
}

.reply-detail-empty-text .panel-title {
  margin: 0;
}

.reply-detail-body {
  display: flex;
  flex-direction: column;
  gap: 0.9rem;
  overflow-y: auto;
  padding-right: 0.2rem;
  flex: 1 1 auto;
  min-height: 0;
  justify-content: flex-start;
  align-items: stretch;
}

.reply-detail-actions {
  display: flex;
  align-items: center;
  gap: 0.6rem;
  color: var(--text-secondary);
  font-size: 0.9rem;
}

.reply-detail-header {
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  gap: 0.85rem;
  padding-bottom: 0.6rem;
  border-bottom: 1px solid var(--border-subtle);
}

.reply-question {
  display: grid;
  grid-template-columns: auto 1fr;
  gap: 0.65rem;
  align-items: flex-start;
}

.reply-question-avatar {
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 0.9rem;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  font-weight: 700;
  color: #fff;
}

.reply-question-content {
  display: grid;
  gap: 0.25rem;
}

.reply-question-meta {
  display: flex;
  align-items: center;
  gap: 0.4rem;
  flex-wrap: wrap;
  color: var(--text-secondary);
  font-size: 0.92rem;
}

.reply-question-author {
  font-weight: 700;
  color: var(--text-primary);
}

.reply-question-time {
  font-size: 0.86rem;
}

.reply-question-text {
  color: var(--text-primary);
  line-height: 1.5;
  word-break: break-word;
}

.reply-count {
  display: inline-flex;
  align-items: center;
  gap: 0.35rem;
}

.reply-count-label {
  text-transform: uppercase;
  letter-spacing: 0.04em;
  font-weight: 600;
  font-size: 0.78rem;
}

.reply-thread {
  display: grid;
  gap: 0.85rem;
  flex: 1 1 auto;
  min-height: 0;
  overflow-y: auto;
  padding-right: 0.2rem;
  margin-left: 0.35rem;
  padding-left: 1rem;
  border-left: 2px solid var(--border-subtle);
  align-content: start;
}

.reply-thread-empty {
  color: var(--text-secondary);
  padding-left: 0.2rem;
}

.reply-thread-branch {
  display: grid;
  gap: 0.65rem;
}

.reply-thread-message {
  display: grid;
  grid-template-columns: auto 1fr;
  gap: 0.55rem;
  align-items: flex-start;
}

.reply-thread-avatar {
  width: 2.35rem;
  height: 2.35rem;
  border-radius: 0.85rem;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  font-weight: 700;
  color: #fff;
}

.reply-thread-bubble {
  background: color-mix(in srgb, var(--bg-soft) 68%, var(--bg-elevated) 32%);
  border: 1px solid color-mix(in srgb, var(--border-subtle) 70%, var(--border-strong) 30%);
  border-radius: var(--radius-lg);
  padding: 0.65rem 0.75rem;
  display: grid;
  gap: 0.28rem;
}

.reply-thread-meta {
  display: flex;
  align-items: center;
  gap: 0.4rem;
  flex-wrap: wrap;
  color: var(--text-secondary);
  font-size: 0.9rem;
  position: relative;
  padding-right: 2.2rem;
}

.reply-thread-author {
  font-weight: 700;
  color: var(--text-primary);
}

.reply-thread-time {
  font-size: 0.84rem;
}

.reply-jump {
  border: 1px solid var(--border-subtle);
  background: var(--bg-elevated);
  color: var(--text-primary);
  border-radius: 0.65rem;
  padding: 0.2rem;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
  cursor: pointer;
  transition: border-color 0.18s ease, background 0.18s ease, color 0.18s ease;
  position: absolute;
  top: 0;
  right: 0;
  width: 2.1rem;
  height: 2.1rem;
  min-width: 2.1rem;
  min-height: 2.1rem;
}

.reply-jump:hover,
.reply-jump:focus-visible {
  border-color: var(--accent);
  color: var(--accent-strong);
  background: color-mix(in srgb, var(--accent-soft) 60%, transparent);
  outline: none;
}

.reply-thread-text {
  color: var(--text-primary);
  line-height: 1.55;
  word-break: break-word;
}

.reply-thread-children {
  display: grid;
  gap: 0.75rem;
  border-left: 2px solid var(--border-subtle);
  padding-left: 1.1rem;
  margin-left: 1.4rem;
  align-content: start;
}

@media (max-width: 600px) {
  body {
    font-size: 14px;
  }
  
  .app-header {
    padding-inline: 0.75rem;
  }
  
  .app-title .badge {
    display: none;
  }
  
  .app-controls {
    flex-direction: column;
    align-items: flex-start;
  }
  
  .room-info,.btn-group {
    width: 100%;
  }
  
  .btn-group {
    justify-content: space-between;
  }
  
  .btn-group button {
    flex: 1 1 0;
    text-align: center;
  }
  
  .panel-subtitle {
    font-size: 0.72rem;
  }
  
  .send-btn {
    min-width: 2.7rem;
  }
}

@media (max-width: 480px) {
  .app-footer {
    padding-inline: 0.75rem;
  }
  
  .app-footer-right {
    flex-wrap: wrap;
    gap: 0.3rem;
  }
  
  .footer-lang {
    flex: 1 1 calc(33% - 0.4rem);
    text-align: center;
    padding-block: 0.2rem;
  }
}

@media (max-width: 768px) {
  .layout.teacher .teacher-panels {
    grid-column: 1 / -1;
  }
}

@media (max-width: 900px) {
  .layout.teacher .teacher-panels {
    grid-template-columns: 1fr;
  }
  .app-controls {
    display: none;
  }
  
  .page-join .app-controls,
    .error-page-shell .app-controls {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }
  
  .page-join .app-controls .app-nav,
    .error-page-shell .app-controls .app-nav {
    display: none;
  }
  
  .mobile-menu-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 2.6rem;
    height: 2.6rem;
    border-radius: 0.9rem;
    border: 1px solid var(--border-subtle);
    background: var(--bg-elevated);
    color: var(--text-primary);
    cursor: pointer;
    gap: 0.3rem;
  }
  .app-footer {
    padding: 1rem 1.1rem;
  }
  
  .footer-grid {
    grid-template-columns: 1fr;
    gap: 0.6rem;
    text-align: left;
  }
  
  .footer-meta {
    align-items: flex-start;
  }
  
    .footer-links {
      justify-content: flex-start;
      gap: 1rem;
    }

  .student-panel,.student-panel .panel-body {
    display: flex;
    overflow: hidden;
    min-height: 0;
  }

  .student-panel .panel-body {
    flex: 1;
    flex-direction: column;
  }

  .questions-list {
    flex: 1;
    min-height: 0;
    overflow-y: auto;
    padding-right: 0.25rem;
  }
}

@media (max-width: 980px) {
  .room-header .panel-header {
    grid-template-columns: 1fr;
  }
  
  .room-header-main {
    width: 100%;
    min-width: 0;
  }
  
  .room-header-aside {
    width: 100%;
    align-items: flex-start;
  }
  
  .room-description-block {
    display: flex;
    width: 100%;
  }
  
  .room-description-block .inline-edit-display,
    .room-description-block .inline-edit-form {
    width: 100%;
  }
  
  .room-status {
    align-self: flex-start;
  }
  
  .room-header .panel-actions {
    justify-content: flex-start;
  }
}

@media (min-width: 769px) {
  .role-teacher,
    .role-student {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
    flex: 1 1 auto;
    min-height: 0;
    width: 100%;
  }
  
  .role-teacher .room-header,
    .role-student .room-header {
    margin-bottom: 0;
    flex-shrink: 0;
  }
  
  #layoutRoot {
    flex: 1 1 auto;
    min-height: 0;
  }
  
  #layoutRoot .panel,
    #layoutRoot .teacher-panels,
    #layoutRoot .teacher-panels .panel {
    height: 100%;
    min-height: 0;
  }
}

@media (max-width: 960px) {
  .create-layout {
    grid-template-columns: 1fr;
  }
  
  .form-footer {
    align-items: stretch;
  }

  .replies-layout {
    grid-template-columns: 1fr;
    border-radius: var(--radius-xl);
  }

  .replies-detail {
    order: 2;
    border-left: none;
    border-top: 1px solid var(--border-subtle);
  }

  .replies-sidebar {
    order: 1;
    border-right: none;
    border-bottom: 1px solid var(--border-subtle);
  }
}

@media (max-width: 720px) {
  .replies-layout {
    border-radius: var(--radius-lg);
    background: transparent;
    border: none;
    gap: 0.55rem;
  }

  .replies-sidebar {
    padding: 0.8rem 0.9rem;
    background: color-mix(in srgb, var(--bg-elevated) 94%, var(--bg-soft) 6%);
    border: 1px solid var(--border-subtle);
    border-radius: var(--radius-lg);
    margin-bottom: 0.25rem;
  }

  .replies-detail {
    padding: 0.9rem 0.95rem 1rem;
    background: color-mix(in srgb, var(--bg-elevated) 95%, var(--bg-soft) 5%);
    border-left: none;
    border-top: none;
    border: 1px solid var(--border-subtle);
    border-radius: var(--radius-lg);
  }

  .reply-detail-header {
    flex-direction: column;
    gap: 0.45rem;
    padding-bottom: 0.45rem;
    position: relative;
    padding-right: 4.2rem;
    padding-top: 0.35rem;
  }

  .reply-detail-actions {
    align-self: flex-end;
    gap: 0.45rem;
    position: absolute;
    top: 0;
    right: 0;
    flex-direction: row;
    justify-content: flex-end;
  }

  .reply-thread {
    margin-left: 0;
    padding-left: 0.7rem;
    border-left: 1px solid var(--border-subtle);
    gap: 0.7rem;
  }

  .reply-thread-children {
    padding-left: 0.9rem;
    margin-left: 0.9rem;
  }

  .reply-thread-bubble {
    padding: 0.6rem 0.7rem;
  }

  .reply-inbox {
    gap: 0.5rem;
  }

  .reply-inbox-item {
    padding: 0.85rem 0.95rem;
  }

  .reply-inbox-author {
    font-size: 0.95rem;
  }

  .reply-inbox-text {
    font-size: 0.95rem;
    line-height: 1.4;
  }

  .reply-inbox-meta,
  .reply-inbox-meta-row {
    font-size: 0.78rem;
  }

  .reply-inbox-meta-label {
    font-size: 0.7rem;
  }

  .reply-question {
    grid-template-columns: auto 1fr;
    align-items: flex-start;
  }

  .reply-question-avatar {
    width: 2.2rem;
    height: 2.2rem;
  }

  .reply-thread-avatar {
    width: 2.1rem;
    height: 2.1rem;
  }

  .reply-thread-text,
  .reply-question-text {
    font-size: 0.95rem;
    line-height: 1.45;
  }

  .reply-detail-actions {
    font-size: 0.82rem;
  }

  .reply-thread-children {
    padding-left: 0.75rem;
    margin-left: 1rem;
    gap: 0.6rem;
    border-left-width: 1px;
  }

  .replies-layout.mobile-thread-open .replies-sidebar {
    display: none;
  }

  .replies-layout.mobile-thread-open .replies-detail {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    z-index: 2;
    border-radius: var(--radius-lg);
    box-shadow: 0 14px 36px rgba(0, 0, 0, 0.16);
  }

  .replies-layout.mobile-thread-open .reply-detail-header {
    position: sticky;
    top: 0;
    background: inherit;
    z-index: 3;
  }

  .reply-jump {
    width: 2.1rem;
    height: 2.1rem;
    min-width: 2.1rem;
    min-height: 2.1rem;
  }
}

@media (max-width: 1200px) {
  .rooms-grid {
    grid-template-columns: repeat(2, minmax(0, 1fr));
  }
}

@media (max-width: 720px) {
  .rooms-grid {
    grid-template-columns: 1fr;
  }
  .dashboard-hero {
    padding: 1rem 1rem 1.1rem;
  }
  
  .dashboard-hero__title {
    font-size: 1.35rem;
  }
  
  .dashboard-hero__actions {
    flex-direction: column;
    align-items: stretch;
    width: 100%;
  }
  
  .dashboard-hero__actions .btn {
    width: 100%;
    justify-content: center;
  }
  
  .room-card {
    padding: 0.75rem 0.8rem 0.85rem;
  }
  
  .room-card-actions .btn {
    width: 100%;
  }
  .chat-composer {
    align-items: flex-start;
  }
  .chat-composer .composer-btn {
    align-self: flex-start;
  }

  .updates-shell {
    padding-inline: 0.9rem;
    margin: 0.75rem auto 3rem;
  }

  .update-article__cover img {
    height: 240px;
  }

  .updates-hero {
    padding: 1rem 1.05rem;
  }
}
